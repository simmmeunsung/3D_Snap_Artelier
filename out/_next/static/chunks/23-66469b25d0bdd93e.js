"use strict";(self.webpackChunk_N_E=self.webpackChunk_N_E||[]).push([[23],{622:function(e,t,s){/**
 * @license React
 * react-jsx-runtime.production.min.js
 *
 * Copyright (c) Meta Platforms, Inc. and affiliates.
 *
 * This source code is licensed under the MIT license found in the
 * LICENSE file in the root directory of this source tree.
 */var i=s(2265),n=Symbol.for("react.element"),r=(Symbol.for("react.fragment"),Object.prototype.hasOwnProperty),a=i.__SECRET_INTERNALS_DO_NOT_USE_OR_YOU_WILL_BE_FIRED.ReactCurrentOwner,o={key:!0,ref:!0,__self:!0,__source:!0};function q(e,t,s){var i,l={},h=null,c=null;for(i in void 0!==s&&(h=""+s),void 0!==t.key&&(h=""+t.key),void 0!==t.ref&&(c=t.ref),t)r.call(t,i)&&!o.hasOwnProperty(i)&&(l[i]=t[i]);if(e&&e.defaultProps)for(i in t=e.defaultProps)void 0===l[i]&&(l[i]=t[i]);return{$$typeof:n,type:e,key:h,ref:c,props:l,_owner:a.current}}t.jsx=q,t.jsxs=q},7437:function(e,t,s){e.exports=s(622)},4112:function(e,t,s){s.d(t,{z:function(){return OrbitControls}});var i=s(2461);let n={type:"change"},r={type:"start"},a={type:"end"},o=new i.zHn,l=new i.JOQ,h=Math.cos(70*i.M8C.DEG2RAD),c=new i.Pa4,u=2*Math.PI,p={NONE:-1,ROTATE:0,DOLLY:1,PAN:2,TOUCH_ROTATE:3,TOUCH_PAN:4,TOUCH_DOLLY_PAN:5,TOUCH_DOLLY_ROTATE:6};let OrbitControls=class OrbitControls extends i.ZXd{constructor(e,t=null){super(e,t),this.state=p.NONE,this.enabled=!0,this.target=new i.Pa4,this.cursor=new i.Pa4,this.minDistance=0,this.maxDistance=1/0,this.minZoom=0,this.maxZoom=1/0,this.minTargetRadius=0,this.maxTargetRadius=1/0,this.minPolarAngle=0,this.maxPolarAngle=Math.PI,this.minAzimuthAngle=-1/0,this.maxAzimuthAngle=1/0,this.enableDamping=!1,this.dampingFactor=.05,this.enableZoom=!0,this.zoomSpeed=1,this.enableRotate=!0,this.rotateSpeed=1,this.enablePan=!0,this.panSpeed=1,this.screenSpacePanning=!0,this.keyPanSpeed=7,this.zoomToCursor=!1,this.autoRotate=!1,this.autoRotateSpeed=2,this.keys={LEFT:"ArrowLeft",UP:"ArrowUp",RIGHT:"ArrowRight",BOTTOM:"ArrowDown"},this.mouseButtons={LEFT:i.RsA.ROTATE,MIDDLE:i.RsA.DOLLY,RIGHT:i.RsA.PAN},this.touches={ONE:i.QmN.ROTATE,TWO:i.QmN.DOLLY_PAN},this.target0=this.target.clone(),this.position0=this.object.position.clone(),this.zoom0=this.object.zoom,this._domElementKeyEvents=null,this._lastPosition=new i.Pa4,this._lastQuaternion=new i._fP,this._lastTargetPosition=new i.Pa4,this._quat=new i._fP().setFromUnitVectors(e.up,new i.Pa4(0,1,0)),this._quatInverse=this._quat.clone().invert(),this._spherical=new i.$V,this._sphericalDelta=new i.$V,this._scale=1,this._panOffset=new i.Pa4,this._rotateStart=new i.FM8,this._rotateEnd=new i.FM8,this._rotateDelta=new i.FM8,this._panStart=new i.FM8,this._panEnd=new i.FM8,this._panDelta=new i.FM8,this._dollyStart=new i.FM8,this._dollyEnd=new i.FM8,this._dollyDelta=new i.FM8,this._dollyDirection=new i.Pa4,this._mouse=new i.FM8,this._performCursorZoom=!1,this._pointers=[],this._pointerPositions={},this._controlActive=!1,this._onPointerMove=onPointerMove.bind(this),this._onPointerDown=onPointerDown.bind(this),this._onPointerUp=onPointerUp.bind(this),this._onContextMenu=onContextMenu.bind(this),this._onMouseWheel=onMouseWheel.bind(this),this._onKeyDown=onKeyDown.bind(this),this._onTouchStart=onTouchStart.bind(this),this._onTouchMove=onTouchMove.bind(this),this._onMouseDown=onMouseDown.bind(this),this._onMouseMove=onMouseMove.bind(this),this._interceptControlDown=interceptControlDown.bind(this),this._interceptControlUp=interceptControlUp.bind(this),null!==this.domElement&&this.connect(),this.update()}connect(){this.domElement.addEventListener("pointerdown",this._onPointerDown),this.domElement.addEventListener("pointercancel",this._onPointerUp),this.domElement.addEventListener("contextmenu",this._onContextMenu),this.domElement.addEventListener("wheel",this._onMouseWheel,{passive:!1});let e=this.domElement.getRootNode();e.addEventListener("keydown",this._interceptControlDown,{passive:!0,capture:!0}),this.domElement.style.touchAction="none"}disconnect(){this.domElement.removeEventListener("pointerdown",this._onPointerDown),this.domElement.removeEventListener("pointermove",this._onPointerMove),this.domElement.removeEventListener("pointerup",this._onPointerUp),this.domElement.removeEventListener("pointercancel",this._onPointerUp),this.domElement.removeEventListener("wheel",this._onMouseWheel),this.domElement.removeEventListener("contextmenu",this._onContextMenu),this.stopListenToKeyEvents();let e=this.domElement.getRootNode();e.removeEventListener("keydown",this._interceptControlDown,{capture:!0}),this.domElement.style.touchAction="auto"}dispose(){this.disconnect()}getPolarAngle(){return this._spherical.phi}getAzimuthalAngle(){return this._spherical.theta}getDistance(){return this.object.position.distanceTo(this.target)}listenToKeyEvents(e){e.addEventListener("keydown",this._onKeyDown),this._domElementKeyEvents=e}stopListenToKeyEvents(){null!==this._domElementKeyEvents&&(this._domElementKeyEvents.removeEventListener("keydown",this._onKeyDown),this._domElementKeyEvents=null)}saveState(){this.target0.copy(this.target),this.position0.copy(this.object.position),this.zoom0=this.object.zoom}reset(){this.target.copy(this.target0),this.object.position.copy(this.position0),this.object.zoom=this.zoom0,this.object.updateProjectionMatrix(),this.dispatchEvent(n),this.update(),this.state=p.NONE}update(e=null){let t=this.object.position;c.copy(t).sub(this.target),c.applyQuaternion(this._quat),this._spherical.setFromVector3(c),this.autoRotate&&this.state===p.NONE&&this._rotateLeft(this._getAutoRotationAngle(e)),this.enableDamping?(this._spherical.theta+=this._sphericalDelta.theta*this.dampingFactor,this._spherical.phi+=this._sphericalDelta.phi*this.dampingFactor):(this._spherical.theta+=this._sphericalDelta.theta,this._spherical.phi+=this._sphericalDelta.phi);let s=this.minAzimuthAngle,r=this.maxAzimuthAngle;isFinite(s)&&isFinite(r)&&(s<-Math.PI?s+=u:s>Math.PI&&(s-=u),r<-Math.PI?r+=u:r>Math.PI&&(r-=u),s<=r?this._spherical.theta=Math.max(s,Math.min(r,this._spherical.theta)):this._spherical.theta=this._spherical.theta>(s+r)/2?Math.max(s,this._spherical.theta):Math.min(r,this._spherical.theta)),this._spherical.phi=Math.max(this.minPolarAngle,Math.min(this.maxPolarAngle,this._spherical.phi)),this._spherical.makeSafe(),!0===this.enableDamping?this.target.addScaledVector(this._panOffset,this.dampingFactor):this.target.add(this._panOffset),this.target.sub(this.cursor),this.target.clampLength(this.minTargetRadius,this.maxTargetRadius),this.target.add(this.cursor);let a=!1;if(this.zoomToCursor&&this._performCursorZoom||this.object.isOrthographicCamera)this._spherical.radius=this._clampDistance(this._spherical.radius);else{let e=this._spherical.radius;this._spherical.radius=this._clampDistance(this._spherical.radius*this._scale),a=e!=this._spherical.radius}if(c.setFromSpherical(this._spherical),c.applyQuaternion(this._quatInverse),t.copy(this.target).add(c),this.object.lookAt(this.target),!0===this.enableDamping?(this._sphericalDelta.theta*=1-this.dampingFactor,this._sphericalDelta.phi*=1-this.dampingFactor,this._panOffset.multiplyScalar(1-this.dampingFactor)):(this._sphericalDelta.set(0,0,0),this._panOffset.set(0,0,0)),this.zoomToCursor&&this._performCursorZoom){let e=null;if(this.object.isPerspectiveCamera){let t=c.length();e=this._clampDistance(t*this._scale);let s=t-e;this.object.position.addScaledVector(this._dollyDirection,s),this.object.updateMatrixWorld(),a=!!s}else if(this.object.isOrthographicCamera){let t=new i.Pa4(this._mouse.x,this._mouse.y,0);t.unproject(this.object);let s=this.object.zoom;this.object.zoom=Math.max(this.minZoom,Math.min(this.maxZoom,this.object.zoom/this._scale)),this.object.updateProjectionMatrix(),a=s!==this.object.zoom;let n=new i.Pa4(this._mouse.x,this._mouse.y,0);n.unproject(this.object),this.object.position.sub(n).add(t),this.object.updateMatrixWorld(),e=c.length()}else console.warn("WARNING: OrbitControls.js encountered an unknown camera type - zoom to cursor disabled."),this.zoomToCursor=!1;null!==e&&(this.screenSpacePanning?this.target.set(0,0,-1).transformDirection(this.object.matrix).multiplyScalar(e).add(this.object.position):(o.origin.copy(this.object.position),o.direction.set(0,0,-1).transformDirection(this.object.matrix),Math.abs(this.object.up.dot(o.direction))<h?this.object.lookAt(this.target):(l.setFromNormalAndCoplanarPoint(this.object.up,this.target),o.intersectPlane(l,this.target))))}else if(this.object.isOrthographicCamera){let e=this.object.zoom;this.object.zoom=Math.max(this.minZoom,Math.min(this.maxZoom,this.object.zoom/this._scale)),e!==this.object.zoom&&(this.object.updateProjectionMatrix(),a=!0)}return this._scale=1,this._performCursorZoom=!1,!!(a||this._lastPosition.distanceToSquared(this.object.position)>1e-6||8*(1-this._lastQuaternion.dot(this.object.quaternion))>1e-6||this._lastTargetPosition.distanceToSquared(this.target)>1e-6)&&(this.dispatchEvent(n),this._lastPosition.copy(this.object.position),this._lastQuaternion.copy(this.object.quaternion),this._lastTargetPosition.copy(this.target),!0)}_getAutoRotationAngle(e){return null!==e?u/60*this.autoRotateSpeed*e:u/60/60*this.autoRotateSpeed}_getZoomScale(e){return Math.pow(.95,this.zoomSpeed*Math.abs(.01*e))}_rotateLeft(e){this._sphericalDelta.theta-=e}_rotateUp(e){this._sphericalDelta.phi-=e}_panLeft(e,t){c.setFromMatrixColumn(t,0),c.multiplyScalar(-e),this._panOffset.add(c)}_panUp(e,t){!0===this.screenSpacePanning?c.setFromMatrixColumn(t,1):(c.setFromMatrixColumn(t,0),c.crossVectors(this.object.up,c)),c.multiplyScalar(e),this._panOffset.add(c)}_pan(e,t){let s=this.domElement;if(this.object.isPerspectiveCamera){let i=this.object.position;c.copy(i).sub(this.target);let n=c.length();n*=Math.tan(this.object.fov/2*Math.PI/180),this._panLeft(2*e*n/s.clientHeight,this.object.matrix),this._panUp(2*t*n/s.clientHeight,this.object.matrix)}else this.object.isOrthographicCamera?(this._panLeft(e*(this.object.right-this.object.left)/this.object.zoom/s.clientWidth,this.object.matrix),this._panUp(t*(this.object.top-this.object.bottom)/this.object.zoom/s.clientHeight,this.object.matrix)):(console.warn("WARNING: OrbitControls.js encountered an unknown camera type - pan disabled."),this.enablePan=!1)}_dollyOut(e){this.object.isPerspectiveCamera||this.object.isOrthographicCamera?this._scale/=e:(console.warn("WARNING: OrbitControls.js encountered an unknown camera type - dolly/zoom disabled."),this.enableZoom=!1)}_dollyIn(e){this.object.isPerspectiveCamera||this.object.isOrthographicCamera?this._scale*=e:(console.warn("WARNING: OrbitControls.js encountered an unknown camera type - dolly/zoom disabled."),this.enableZoom=!1)}_updateZoomParameters(e,t){if(!this.zoomToCursor)return;this._performCursorZoom=!0;let s=this.domElement.getBoundingClientRect(),i=e-s.left,n=t-s.top,r=s.width,a=s.height;this._mouse.x=i/r*2-1,this._mouse.y=-(2*(n/a))+1,this._dollyDirection.set(this._mouse.x,this._mouse.y,1).unproject(this.object).sub(this.object.position).normalize()}_clampDistance(e){return Math.max(this.minDistance,Math.min(this.maxDistance,e))}_handleMouseDownRotate(e){this._rotateStart.set(e.clientX,e.clientY)}_handleMouseDownDolly(e){this._updateZoomParameters(e.clientX,e.clientX),this._dollyStart.set(e.clientX,e.clientY)}_handleMouseDownPan(e){this._panStart.set(e.clientX,e.clientY)}_handleMouseMoveRotate(e){this._rotateEnd.set(e.clientX,e.clientY),this._rotateDelta.subVectors(this._rotateEnd,this._rotateStart).multiplyScalar(this.rotateSpeed);let t=this.domElement;this._rotateLeft(u*this._rotateDelta.x/t.clientHeight),this._rotateUp(u*this._rotateDelta.y/t.clientHeight),this._rotateStart.copy(this._rotateEnd),this.update()}_handleMouseMoveDolly(e){this._dollyEnd.set(e.clientX,e.clientY),this._dollyDelta.subVectors(this._dollyEnd,this._dollyStart),this._dollyDelta.y>0?this._dollyOut(this._getZoomScale(this._dollyDelta.y)):this._dollyDelta.y<0&&this._dollyIn(this._getZoomScale(this._dollyDelta.y)),this._dollyStart.copy(this._dollyEnd),this.update()}_handleMouseMovePan(e){this._panEnd.set(e.clientX,e.clientY),this._panDelta.subVectors(this._panEnd,this._panStart).multiplyScalar(this.panSpeed),this._pan(this._panDelta.x,this._panDelta.y),this._panStart.copy(this._panEnd),this.update()}_handleMouseWheel(e){this._updateZoomParameters(e.clientX,e.clientY),e.deltaY<0?this._dollyIn(this._getZoomScale(e.deltaY)):e.deltaY>0&&this._dollyOut(this._getZoomScale(e.deltaY)),this.update()}_handleKeyDown(e){let t=!1;switch(e.code){case this.keys.UP:e.ctrlKey||e.metaKey||e.shiftKey?this.enableRotate&&this._rotateUp(u*this.rotateSpeed/this.domElement.clientHeight):this.enablePan&&this._pan(0,this.keyPanSpeed),t=!0;break;case this.keys.BOTTOM:e.ctrlKey||e.metaKey||e.shiftKey?this.enableRotate&&this._rotateUp(-u*this.rotateSpeed/this.domElement.clientHeight):this.enablePan&&this._pan(0,-this.keyPanSpeed),t=!0;break;case this.keys.LEFT:e.ctrlKey||e.metaKey||e.shiftKey?this.enableRotate&&this._rotateLeft(u*this.rotateSpeed/this.domElement.clientHeight):this.enablePan&&this._pan(this.keyPanSpeed,0),t=!0;break;case this.keys.RIGHT:e.ctrlKey||e.metaKey||e.shiftKey?this.enableRotate&&this._rotateLeft(-u*this.rotateSpeed/this.domElement.clientHeight):this.enablePan&&this._pan(-this.keyPanSpeed,0),t=!0}t&&(e.preventDefault(),this.update())}_handleTouchStartRotate(e){if(1===this._pointers.length)this._rotateStart.set(e.pageX,e.pageY);else{let t=this._getSecondPointerPosition(e),s=.5*(e.pageX+t.x),i=.5*(e.pageY+t.y);this._rotateStart.set(s,i)}}_handleTouchStartPan(e){if(1===this._pointers.length)this._panStart.set(e.pageX,e.pageY);else{let t=this._getSecondPointerPosition(e),s=.5*(e.pageX+t.x),i=.5*(e.pageY+t.y);this._panStart.set(s,i)}}_handleTouchStartDolly(e){let t=this._getSecondPointerPosition(e),s=e.pageX-t.x,i=e.pageY-t.y;this._dollyStart.set(0,Math.sqrt(s*s+i*i))}_handleTouchStartDollyPan(e){this.enableZoom&&this._handleTouchStartDolly(e),this.enablePan&&this._handleTouchStartPan(e)}_handleTouchStartDollyRotate(e){this.enableZoom&&this._handleTouchStartDolly(e),this.enableRotate&&this._handleTouchStartRotate(e)}_handleTouchMoveRotate(e){if(1==this._pointers.length)this._rotateEnd.set(e.pageX,e.pageY);else{let t=this._getSecondPointerPosition(e),s=.5*(e.pageX+t.x),i=.5*(e.pageY+t.y);this._rotateEnd.set(s,i)}this._rotateDelta.subVectors(this._rotateEnd,this._rotateStart).multiplyScalar(this.rotateSpeed);let t=this.domElement;this._rotateLeft(u*this._rotateDelta.x/t.clientHeight),this._rotateUp(u*this._rotateDelta.y/t.clientHeight),this._rotateStart.copy(this._rotateEnd)}_handleTouchMovePan(e){if(1===this._pointers.length)this._panEnd.set(e.pageX,e.pageY);else{let t=this._getSecondPointerPosition(e),s=.5*(e.pageX+t.x),i=.5*(e.pageY+t.y);this._panEnd.set(s,i)}this._panDelta.subVectors(this._panEnd,this._panStart).multiplyScalar(this.panSpeed),this._pan(this._panDelta.x,this._panDelta.y),this._panStart.copy(this._panEnd)}_handleTouchMoveDolly(e){let t=this._getSecondPointerPosition(e),s=e.pageX-t.x,i=e.pageY-t.y;this._dollyEnd.set(0,Math.sqrt(s*s+i*i)),this._dollyDelta.set(0,Math.pow(this._dollyEnd.y/this._dollyStart.y,this.zoomSpeed)),this._dollyOut(this._dollyDelta.y),this._dollyStart.copy(this._dollyEnd);let n=(e.pageX+t.x)*.5,r=(e.pageY+t.y)*.5;this._updateZoomParameters(n,r)}_handleTouchMoveDollyPan(e){this.enableZoom&&this._handleTouchMoveDolly(e),this.enablePan&&this._handleTouchMovePan(e)}_handleTouchMoveDollyRotate(e){this.enableZoom&&this._handleTouchMoveDolly(e),this.enableRotate&&this._handleTouchMoveRotate(e)}_addPointer(e){this._pointers.push(e.pointerId)}_removePointer(e){delete this._pointerPositions[e.pointerId];for(let t=0;t<this._pointers.length;t++)if(this._pointers[t]==e.pointerId){this._pointers.splice(t,1);return}}_isTrackingPointer(e){for(let t=0;t<this._pointers.length;t++)if(this._pointers[t]==e.pointerId)return!0;return!1}_trackPointer(e){let t=this._pointerPositions[e.pointerId];void 0===t&&(t=new i.FM8,this._pointerPositions[e.pointerId]=t),t.set(e.pageX,e.pageY)}_getSecondPointerPosition(e){let t=e.pointerId===this._pointers[0]?this._pointers[1]:this._pointers[0];return this._pointerPositions[t]}_customWheelEvent(e){let t=e.deltaMode,s={clientX:e.clientX,clientY:e.clientY,deltaY:e.deltaY};switch(t){case 1:s.deltaY*=16;break;case 2:s.deltaY*=100}return e.ctrlKey&&!this._controlActive&&(s.deltaY*=10),s}};function onPointerDown(e){!1!==this.enabled&&(0===this._pointers.length&&(this.domElement.setPointerCapture(e.pointerId),this.domElement.addEventListener("pointermove",this._onPointerMove),this.domElement.addEventListener("pointerup",this._onPointerUp)),this._isTrackingPointer(e)||(this._addPointer(e),"touch"===e.pointerType?this._onTouchStart(e):this._onMouseDown(e)))}function onPointerMove(e){!1!==this.enabled&&("touch"===e.pointerType?this._onTouchMove(e):this._onMouseMove(e))}function onPointerUp(e){switch(this._removePointer(e),this._pointers.length){case 0:this.domElement.releasePointerCapture(e.pointerId),this.domElement.removeEventListener("pointermove",this._onPointerMove),this.domElement.removeEventListener("pointerup",this._onPointerUp),this.dispatchEvent(a),this.state=p.NONE;break;case 1:let t=this._pointers[0],s=this._pointerPositions[t];this._onTouchStart({pointerId:t,pageX:s.x,pageY:s.y})}}function onMouseDown(e){let t;switch(e.button){case 0:t=this.mouseButtons.LEFT;break;case 1:t=this.mouseButtons.MIDDLE;break;case 2:t=this.mouseButtons.RIGHT;break;default:t=-1}switch(t){case i.RsA.DOLLY:if(!1===this.enableZoom)return;this._handleMouseDownDolly(e),this.state=p.DOLLY;break;case i.RsA.ROTATE:if(e.ctrlKey||e.metaKey||e.shiftKey){if(!1===this.enablePan)return;this._handleMouseDownPan(e),this.state=p.PAN}else{if(!1===this.enableRotate)return;this._handleMouseDownRotate(e),this.state=p.ROTATE}break;case i.RsA.PAN:if(e.ctrlKey||e.metaKey||e.shiftKey){if(!1===this.enableRotate)return;this._handleMouseDownRotate(e),this.state=p.ROTATE}else{if(!1===this.enablePan)return;this._handleMouseDownPan(e),this.state=p.PAN}break;default:this.state=p.NONE}this.state!==p.NONE&&this.dispatchEvent(r)}function onMouseMove(e){switch(this.state){case p.ROTATE:if(!1===this.enableRotate)return;this._handleMouseMoveRotate(e);break;case p.DOLLY:if(!1===this.enableZoom)return;this._handleMouseMoveDolly(e);break;case p.PAN:if(!1===this.enablePan)return;this._handleMouseMovePan(e)}}function onMouseWheel(e){!1!==this.enabled&&!1!==this.enableZoom&&this.state===p.NONE&&(e.preventDefault(),this.dispatchEvent(r),this._handleMouseWheel(this._customWheelEvent(e)),this.dispatchEvent(a))}function onKeyDown(e){!1!==this.enabled&&this._handleKeyDown(e)}function onTouchStart(e){switch(this._trackPointer(e),this._pointers.length){case 1:switch(this.touches.ONE){case i.QmN.ROTATE:if(!1===this.enableRotate)return;this._handleTouchStartRotate(e),this.state=p.TOUCH_ROTATE;break;case i.QmN.PAN:if(!1===this.enablePan)return;this._handleTouchStartPan(e),this.state=p.TOUCH_PAN;break;default:this.state=p.NONE}break;case 2:switch(this.touches.TWO){case i.QmN.DOLLY_PAN:if(!1===this.enableZoom&&!1===this.enablePan)return;this._handleTouchStartDollyPan(e),this.state=p.TOUCH_DOLLY_PAN;break;case i.QmN.DOLLY_ROTATE:if(!1===this.enableZoom&&!1===this.enableRotate)return;this._handleTouchStartDollyRotate(e),this.state=p.TOUCH_DOLLY_ROTATE;break;default:this.state=p.NONE}break;default:this.state=p.NONE}this.state!==p.NONE&&this.dispatchEvent(r)}function onTouchMove(e){switch(this._trackPointer(e),this.state){case p.TOUCH_ROTATE:if(!1===this.enableRotate)return;this._handleTouchMoveRotate(e),this.update();break;case p.TOUCH_PAN:if(!1===this.enablePan)return;this._handleTouchMovePan(e),this.update();break;case p.TOUCH_DOLLY_PAN:if(!1===this.enableZoom&&!1===this.enablePan)return;this._handleTouchMoveDollyPan(e),this.update();break;case p.TOUCH_DOLLY_ROTATE:if(!1===this.enableZoom&&!1===this.enableRotate)return;this._handleTouchMoveDollyRotate(e),this.update();break;default:this.state=p.NONE}}function onContextMenu(e){!1!==this.enabled&&e.preventDefault()}function interceptControlDown(e){if("Control"===e.key){this._controlActive=!0;let e=this.domElement.getRootNode();e.addEventListener("keyup",this._interceptControlUp,{passive:!0,capture:!0})}}function interceptControlUp(e){if("Control"===e.key){this._controlActive=!1;let e=this.domElement.getRootNode();e.removeEventListener("keyup",this._interceptControlUp,{passive:!0,capture:!0})}}},1137:function(e,t,s){s.d(t,{M:function(){return GLTFExporter}});var i=s(2461);let n={POSITION:["byte","byte normalized","unsigned byte","unsigned byte normalized","short","short normalized","unsigned short","unsigned short normalized"],NORMAL:["byte normalized","short normalized"],TANGENT:["byte normalized","short normalized"],TEXCOORD:["byte","byte normalized","unsigned byte","short","short normalized","unsigned short"]};let GLTFExporter=class GLTFExporter{constructor(){this.textureUtils=null,this.pluginCallbacks=[],this.register(function(e){return new GLTFLightExtension(e)}),this.register(function(e){return new GLTFMaterialsUnlitExtension(e)}),this.register(function(e){return new GLTFMaterialsTransmissionExtension(e)}),this.register(function(e){return new GLTFMaterialsVolumeExtension(e)}),this.register(function(e){return new GLTFMaterialsIorExtension(e)}),this.register(function(e){return new GLTFMaterialsSpecularExtension(e)}),this.register(function(e){return new GLTFMaterialsClearcoatExtension(e)}),this.register(function(e){return new GLTFMaterialsDispersionExtension(e)}),this.register(function(e){return new GLTFMaterialsIridescenceExtension(e)}),this.register(function(e){return new GLTFMaterialsSheenExtension(e)}),this.register(function(e){return new GLTFMaterialsAnisotropyExtension(e)}),this.register(function(e){return new GLTFMaterialsEmissiveStrengthExtension(e)}),this.register(function(e){return new GLTFMaterialsBumpExtension(e)}),this.register(function(e){return new GLTFMeshGpuInstancing(e)})}register(e){return -1===this.pluginCallbacks.indexOf(e)&&this.pluginCallbacks.push(e),this}unregister(e){return -1!==this.pluginCallbacks.indexOf(e)&&this.pluginCallbacks.splice(this.pluginCallbacks.indexOf(e),1),this}setTextureUtils(e){return this.textureUtils=e,this}parse(e,t,s,i){let n=new GLTFWriter,r=[];for(let e=0,t=this.pluginCallbacks.length;e<t;e++)r.push(this.pluginCallbacks[e](n));n.setPlugins(r),n.setTextureUtils(this.textureUtils),n.writeAsync(e,t,i).catch(s)}parseAsync(e,t){let s=this;return new Promise(function(i,n){s.parse(e,i,n,t)})}};let r={POINTS:0,LINES:1,LINE_LOOP:2,LINE_STRIP:3,TRIANGLES:4,BYTE:5120,UNSIGNED_BYTE:5121,SHORT:5122,UNSIGNED_SHORT:5123,INT:5124,UNSIGNED_INT:5125,FLOAT:5126,ARRAY_BUFFER:34962,ELEMENT_ARRAY_BUFFER:34963,NEAREST:9728,LINEAR:9729,NEAREST_MIPMAP_NEAREST:9984,LINEAR_MIPMAP_NEAREST:9985,NEAREST_MIPMAP_LINEAR:9986,LINEAR_MIPMAP_LINEAR:9987,CLAMP_TO_EDGE:33071,MIRRORED_REPEAT:33648,REPEAT:10497},a="KHR_mesh_quantization",o={};o[i.TyD]=r.NEAREST,o[i.YLQ]=r.NEAREST_MIPMAP_NEAREST,o[i.aH4]=r.NEAREST_MIPMAP_LINEAR,o[i.wem]=r.LINEAR,o[i.qyh]=r.LINEAR_MIPMAP_NEAREST,o[i.D1R]=r.LINEAR_MIPMAP_LINEAR,o[i.uWy]=r.CLAMP_TO_EDGE,o[i.rpg]=r.REPEAT,o[i.OoA]=r.MIRRORED_REPEAT;let l={scale:"scale",position:"translation",quaternion:"rotation",morphTargetInfluences:"weights"},h=new i.Ilk;function equalArray(e,t){return e.length===t.length&&e.every(function(e,s){return e===t[s]})}function getPaddedBufferSize(e){return 4*Math.ceil(e/4)}function getPaddedArrayBuffer(e,t=0){let s=getPaddedBufferSize(e.byteLength);if(s!==e.byteLength){let i=new Uint8Array(s);if(i.set(new Uint8Array(e)),0!==t)for(let n=e.byteLength;n<s;n++)i[n]=t;return i.buffer}return e}function getCanvas(){return"undefined"==typeof document&&"undefined"!=typeof OffscreenCanvas?new OffscreenCanvas(1,1):document.createElement("canvas")}function getToBlobPromise(e,t){let s;return void 0!==e.toBlob?new Promise(s=>e.toBlob(s,t)):("image/jpeg"===t?s=.92:"image/webp"===t&&(s=.8),e.convertToBlob({type:t,quality:s}))}let GLTFWriter=class GLTFWriter{constructor(){this.plugins=[],this.options={},this.pending=[],this.buffers=[],this.byteOffset=0,this.buffers=[],this.nodeMap=new Map,this.skins=[],this.extensionsUsed={},this.extensionsRequired={},this.uids=new Map,this.uid=0,this.json={asset:{version:"2.0",generator:"THREE.GLTFExporter r"+i.UZH}},this.cache={meshes:new Map,attributes:new Map,attributesNormalized:new Map,materials:new Map,textures:new Map,images:new Map},this.textureUtils=null}setPlugins(e){this.plugins=e}setTextureUtils(e){this.textureUtils=e}async writeAsync(e,t,s={}){this.options=Object.assign({binary:!1,trs:!1,onlyVisible:!0,maxTextureSize:1/0,animations:[],includeCustomExtensions:!1},s),this.options.animations.length>0&&(this.options.trs=!0),await this.processInputAsync(e),await Promise.all(this.pending);let i=this.buffers,n=this.json;s=this.options;let r=this.extensionsUsed,a=this.extensionsRequired,o=new Blob(i,{type:"application/octet-stream"}),l=Object.keys(r),h=Object.keys(a);if(l.length>0&&(n.extensionsUsed=l),h.length>0&&(n.extensionsRequired=h),n.buffers&&n.buffers.length>0&&(n.buffers[0].byteLength=o.size),!0===s.binary){let e=new FileReader;e.readAsArrayBuffer(o),e.onloadend=function(){var s;let i=getPaddedArrayBuffer(e.result),r=new DataView(new ArrayBuffer(8));r.setUint32(0,i.byteLength,!0),r.setUint32(4,5130562,!0);let a=getPaddedArrayBuffer((s=JSON.stringify(n),new TextEncoder().encode(s).buffer),32),o=new DataView(new ArrayBuffer(8));o.setUint32(0,a.byteLength,!0),o.setUint32(4,1313821514,!0);let l=new ArrayBuffer(12),h=new DataView(l);h.setUint32(0,1179937895,!0),h.setUint32(4,2,!0);let c=12+o.byteLength+a.byteLength+r.byteLength+i.byteLength;h.setUint32(8,c,!0);let u=new Blob([l,o,a,r,i],{type:"application/octet-stream"}),p=new FileReader;p.readAsArrayBuffer(u),p.onloadend=function(){t(p.result)}}}else if(n.buffers&&n.buffers.length>0){let e=new FileReader;e.readAsDataURL(o),e.onloadend=function(){let s=e.result;n.buffers[0].uri=s,t(n)}}else t(n)}serializeUserData(e,t){if(0===Object.keys(e.userData).length)return;let s=this.options,i=this.extensionsUsed;try{let n=JSON.parse(JSON.stringify(e.userData));if(s.includeCustomExtensions&&n.gltfExtensions){for(let e in void 0===t.extensions&&(t.extensions={}),n.gltfExtensions)t.extensions[e]=n.gltfExtensions[e],i[e]=!0;delete n.gltfExtensions}Object.keys(n).length>0&&(t.extras=n)}catch(t){console.warn("THREE.GLTFExporter: userData of '"+e.name+"' won't be serialized because of JSON.stringify error - "+t.message)}}getUID(e,t=!1){if(!1===this.uids.has(e)){let t=new Map;t.set(!0,this.uid++),t.set(!1,this.uid++),this.uids.set(e,t)}let s=this.uids.get(e);return s.get(t)}isNormalizedNormalAttribute(e){let t=this.cache;if(t.attributesNormalized.has(e))return!1;let s=new i.Pa4;for(let t=0,i=e.count;t<i;t++)if(Math.abs(s.fromBufferAttribute(e,t).length()-1)>5e-4)return!1;return!0}createNormalizedNormalAttribute(e){let t=this.cache;if(t.attributesNormalized.has(e))return t.attributesNormalized.get(e);let s=e.clone(),n=new i.Pa4;for(let e=0,t=s.count;e<t;e++)n.fromBufferAttribute(s,e),0===n.x&&0===n.y&&0===n.z?n.setX(1):n.normalize(),s.setXYZ(e,n.x,n.y,n.z);return t.attributesNormalized.set(e,s),s}applyTextureTransform(e,t){let s=!1,i={};(0!==t.offset.x||0!==t.offset.y)&&(i.offset=t.offset.toArray(),s=!0),0!==t.rotation&&(i.rotation=t.rotation,s=!0),(1!==t.repeat.x||1!==t.repeat.y)&&(i.scale=t.repeat.toArray(),s=!0),s&&(e.extensions=e.extensions||{},e.extensions.KHR_texture_transform=i,this.extensionsUsed.KHR_texture_transform=!0)}async buildMetalRoughTextureAsync(e,t){if(e===t)return e;function getEncodingConversion(e){return e.colorSpace===i.KI_?function(e){return e<.04045?.0773993808*e:Math.pow(.9478672986*e+.0521327014,2.4)}:function(e){return e}}e instanceof i.EB7&&(e=await this.decompressTextureAsync(e)),t instanceof i.EB7&&(t=await this.decompressTextureAsync(t));let s=e?e.image:null,n=t?t.image:null,r=Math.max(s?s.width:0,n?n.width:0),a=Math.max(s?s.height:0,n?n.height:0),o=getCanvas();o.width=r,o.height=a;let l=o.getContext("2d",{willReadFrequently:!0});l.fillStyle="#00ffff",l.fillRect(0,0,r,a);let h=l.getImageData(0,0,r,a);if(s){l.drawImage(s,0,0,r,a);let t=getEncodingConversion(e),i=l.getImageData(0,0,r,a).data;for(let e=2;e<i.length;e+=4)h.data[e]=256*t(i[e]/256)}if(n){l.drawImage(n,0,0,r,a);let e=getEncodingConversion(t),s=l.getImageData(0,0,r,a).data;for(let t=1;t<s.length;t+=4)h.data[t]=256*e(s[t]/256)}l.putImageData(h,0,0);let c=e||t,u=c.clone();return u.source=new i.Hw6(o),u.colorSpace=i.aCh,u.channel=(e||t).channel,e&&t&&e.channel!==t.channel&&console.warn("THREE.GLTFExporter: UV channels for metalnessMap and roughnessMap textures must match."),console.warn("THREE.GLTFExporter: Merged metalnessMap and roughnessMap textures."),u}async decompressTextureAsync(e,t=1/0){if(null===this.textureUtils)throw Error("THREE.GLTFExporter: setTextureUtils() must be called to process compressed textures.");return await this.textureUtils.decompress(e,t)}processBuffer(e){let t=this.json,s=this.buffers;return t.buffers||(t.buffers=[{byteLength:0}]),s.push(e),0}processBufferView(e,t,s,n,a){let o;let l=this.json;switch(l.bufferViews||(l.bufferViews=[]),t){case r.BYTE:case r.UNSIGNED_BYTE:o=1;break;case r.SHORT:case r.UNSIGNED_SHORT:o=2;break;default:o=4}let h=e.itemSize*o;a===r.ARRAY_BUFFER&&(h=4*Math.ceil(h/4));let c=getPaddedBufferSize(n*h),u=new DataView(new ArrayBuffer(c)),p=0;for(let a=s;a<s+n;a++){for(let s=0;s<e.itemSize;s++){let n;e.itemSize>4?n=e.array[a*e.itemSize+s]:(0===s?n=e.getX(a):1===s?n=e.getY(a):2===s?n=e.getZ(a):3===s&&(n=e.getW(a)),!0===e.normalized&&(n=i.M8C.normalize(n,e.array))),t===r.FLOAT?u.setFloat32(p,n,!0):t===r.INT?u.setInt32(p,n,!0):t===r.UNSIGNED_INT?u.setUint32(p,n,!0):t===r.SHORT?u.setInt16(p,n,!0):t===r.UNSIGNED_SHORT?u.setUint16(p,n,!0):t===r.BYTE?u.setInt8(p,n):t===r.UNSIGNED_BYTE&&u.setUint8(p,n),p+=o}p%h!=0&&(p+=h-p%h)}let d={buffer:this.processBuffer(u.buffer),byteOffset:this.byteOffset,byteLength:c};void 0!==a&&(d.target=a),a===r.ARRAY_BUFFER&&(d.byteStride=h),this.byteOffset+=c,l.bufferViews.push(d);let m={id:l.bufferViews.length-1,byteLength:0};return m}processBufferViewImage(e){let t=this,s=t.json;return s.bufferViews||(s.bufferViews=[]),new Promise(function(i){let n=new FileReader;n.readAsArrayBuffer(e),n.onloadend=function(){let e=getPaddedArrayBuffer(n.result),r={buffer:t.processBuffer(e),byteOffset:t.byteOffset,byteLength:e.byteLength};t.byteOffset+=e.byteLength,i(s.bufferViews.push(r)-1)}})}processAccessor(e,t,s,n){let a,o;let l=this.json;if(e.array.constructor===Float32Array)a=r.FLOAT;else if(e.array.constructor===Int32Array)a=r.INT;else if(e.array.constructor===Uint32Array)a=r.UNSIGNED_INT;else if(e.array.constructor===Int16Array)a=r.SHORT;else if(e.array.constructor===Uint16Array)a=r.UNSIGNED_SHORT;else if(e.array.constructor===Int8Array)a=r.BYTE;else if(e.array.constructor===Uint8Array)a=r.UNSIGNED_BYTE;else throw Error("THREE.GLTFExporter: Unsupported bufferAttribute component type: "+e.array.constructor.name);if(void 0===s&&(s=0),(void 0===n||n===1/0)&&(n=e.count),0===n)return null;let h=function(e,t,s){let n={min:Array(e.itemSize).fill(Number.POSITIVE_INFINITY),max:Array(e.itemSize).fill(Number.NEGATIVE_INFINITY)};for(let r=t;r<t+s;r++)for(let t=0;t<e.itemSize;t++){let s;e.itemSize>4?s=e.array[r*e.itemSize+t]:(0===t?s=e.getX(r):1===t?s=e.getY(r):2===t?s=e.getZ(r):3===t&&(s=e.getW(r)),!0===e.normalized&&(s=i.M8C.normalize(s,e.array))),n.min[t]=Math.min(n.min[t],s),n.max[t]=Math.max(n.max[t],s)}return n}(e,s,n);void 0!==t&&(o=e===t.index?r.ELEMENT_ARRAY_BUFFER:r.ARRAY_BUFFER);let c=this.processBufferView(e,a,s,n,o),u={bufferView:c.id,byteOffset:c.byteOffset,componentType:a,count:n,max:h.max,min:h.min,type:{1:"SCALAR",2:"VEC2",3:"VEC3",4:"VEC4",9:"MAT3",16:"MAT4"}[e.itemSize]};return!0===e.normalized&&(u.normalized=!0),l.accessors||(l.accessors=[]),l.accessors.push(u)-1}processImage(e,t,s,n="image/png"){if(null!==e){let r=this,a=r.cache,o=r.json,l=r.options,h=r.pending;a.images.has(e)||a.images.set(e,{});let c=a.images.get(e),u=n+":flipY/"+s.toString();if(void 0!==c[u])return c[u];o.images||(o.images=[]);let p={mimeType:n},d=getCanvas();d.width=Math.min(e.width,l.maxTextureSize),d.height=Math.min(e.height,l.maxTextureSize);let m=d.getContext("2d",{willReadFrequently:!0});if(!0===s&&(m.translate(0,d.height),m.scale(1,-1)),void 0!==e.data){t!==i.wk1&&console.error("GLTFExporter: Only RGBAFormat is supported.",t),(e.width>l.maxTextureSize||e.height>l.maxTextureSize)&&console.warn("GLTFExporter: Image size is bigger than maxTextureSize",e);let s=new Uint8ClampedArray(e.height*e.width*4);for(let t=0;t<s.length;t+=4)s[t+0]=e.data[t+0],s[t+1]=e.data[t+1],s[t+2]=e.data[t+2],s[t+3]=e.data[t+3];m.putImageData(new ImageData(s,e.width,e.height),0,0)}else if("undefined"!=typeof HTMLImageElement&&e instanceof HTMLImageElement||"undefined"!=typeof HTMLCanvasElement&&e instanceof HTMLCanvasElement||"undefined"!=typeof ImageBitmap&&e instanceof ImageBitmap||"undefined"!=typeof OffscreenCanvas&&e instanceof OffscreenCanvas)m.drawImage(e,0,0,d.width,d.height);else throw Error("THREE.GLTFExporter: Invalid image type. Use HTMLImageElement, HTMLCanvasElement, ImageBitmap or OffscreenCanvas.");!0===l.binary?h.push(getToBlobPromise(d,n).then(e=>r.processBufferViewImage(e)).then(e=>{p.bufferView=e})):void 0!==d.toDataURL?p.uri=d.toDataURL(n):h.push(getToBlobPromise(d,n).then(e=>new FileReader().readAsDataURL(e)).then(e=>{p.uri=e}));let f=o.images.push(p)-1;return c[u]=f,f}throw Error("THREE.GLTFExporter: No valid image data found. Unable to process texture.")}processSampler(e){let t=this.json;t.samplers||(t.samplers=[]);let s={magFilter:o[e.magFilter],minFilter:o[e.minFilter],wrapS:o[e.wrapS],wrapT:o[e.wrapT]};return t.samplers.push(s)-1}async processTextureAsync(e){let t=this.options,s=this.cache,n=this.json;if(s.textures.has(e))return s.textures.get(e);n.textures||(n.textures=[]),e instanceof i.EB7&&(e=await this.decompressTextureAsync(e,t.maxTextureSize));let r=e.userData.mimeType;"image/webp"===r&&(r="image/png");let a={sampler:this.processSampler(e),source:this.processImage(e.image,e.format,e.flipY,r)};e.name&&(a.name=e.name),await this._invokeAllAsync(async function(t){t.writeTexture&&await t.writeTexture(e,a)});let o=n.textures.push(a)-1;return s.textures.set(e,o),o}async processMaterialAsync(e){let t=this.cache,s=this.json;if(t.materials.has(e))return t.materials.get(e);if(e.isShaderMaterial)return console.warn("GLTFExporter: THREE.ShaderMaterial not supported."),null;s.materials||(s.materials=[]);let n={pbrMetallicRoughness:{}};!0!==e.isMeshStandardMaterial&&!0!==e.isMeshBasicMaterial&&console.warn("GLTFExporter: Use MeshStandardMaterial or MeshBasicMaterial for best results.");let r=e.color.toArray().concat([e.opacity]);if(equalArray(r,[1,1,1,1])||(n.pbrMetallicRoughness.baseColorFactor=r),e.isMeshStandardMaterial?(n.pbrMetallicRoughness.metallicFactor=e.metalness,n.pbrMetallicRoughness.roughnessFactor=e.roughness):(n.pbrMetallicRoughness.metallicFactor=0,n.pbrMetallicRoughness.roughnessFactor=1),e.metalnessMap||e.roughnessMap){let t=await this.buildMetalRoughTextureAsync(e.metalnessMap,e.roughnessMap),s={index:await this.processTextureAsync(t),texCoord:t.channel};this.applyTextureTransform(s,t),n.pbrMetallicRoughness.metallicRoughnessTexture=s}if(e.map){let t={index:await this.processTextureAsync(e.map),texCoord:e.map.channel};this.applyTextureTransform(t,e.map),n.pbrMetallicRoughness.baseColorTexture=t}if(e.emissive){let t=e.emissive,s=Math.max(t.r,t.g,t.b);if(s>0&&(n.emissiveFactor=e.emissive.toArray()),e.emissiveMap){let t={index:await this.processTextureAsync(e.emissiveMap),texCoord:e.emissiveMap.channel};this.applyTextureTransform(t,e.emissiveMap),n.emissiveTexture=t}}if(e.normalMap){let t={index:await this.processTextureAsync(e.normalMap),texCoord:e.normalMap.channel};e.normalScale&&1!==e.normalScale.x&&(t.scale=e.normalScale.x),this.applyTextureTransform(t,e.normalMap),n.normalTexture=t}if(e.aoMap){let t={index:await this.processTextureAsync(e.aoMap),texCoord:e.aoMap.channel};1!==e.aoMapIntensity&&(t.strength=e.aoMapIntensity),this.applyTextureTransform(t,e.aoMap),n.occlusionTexture=t}e.transparent?n.alphaMode="BLEND":e.alphaTest>0&&(n.alphaMode="MASK",n.alphaCutoff=e.alphaTest),e.side===i.ehD&&(n.doubleSided=!0),""!==e.name&&(n.name=e.name),this.serializeUserData(e,n),await this._invokeAllAsync(async function(t){t.writeMaterialAsync&&await t.writeMaterialAsync(e,n)});let a=s.materials.push(n)-1;return t.materials.set(e,a),a}async processMeshAsync(e){let t;let s=this.cache,n=this.json,a=[e.geometry.uuid];if(Array.isArray(e.material))for(let t=0,s=e.material.length;t<s;t++)a.push(e.material[t].uuid);else a.push(e.material.uuid);let o=a.join(":");if(s.meshes.has(o))return s.meshes.get(o);let l=e.geometry;t=e.isLineSegments?r.LINES:e.isLineLoop?r.LINE_LOOP:e.isLine?r.LINE_STRIP:e.isPoints?r.POINTS:e.material.wireframe?r.LINES:r.TRIANGLES;let h={},c={},u=[],p=[],d={uv:"TEXCOORD_0",uv1:"TEXCOORD_1",uv2:"TEXCOORD_2",uv3:"TEXCOORD_3",color:"COLOR_0",skinWeight:"WEIGHTS_0",skinIndex:"JOINTS_0"},m=l.getAttribute("normal");void 0===m||this.isNormalizedNormalAttribute(m)||(console.warn("THREE.GLTFExporter: Creating normalized normal attribute from the non-normalized one."),l.setAttribute("normal",this.createNormalizedNormalAttribute(m)));let f=null;for(let e in l.attributes){if("morph"===e.slice(0,5))continue;let t=l.attributes[e];e=d[e]||e.toUpperCase();let n=/^(POSITION|NORMAL|TANGENT|TEXCOORD_\d+|COLOR_\d+|JOINTS_\d+|WEIGHTS_\d+)$/;if(n.test(e)||(e="_"+e),s.attributes.has(this.getUID(t))){c[e]=s.attributes.get(this.getUID(t));continue}f=null;let r=t.array;"JOINTS_0"!==e||r instanceof Uint16Array||r instanceof Uint8Array?(r instanceof Uint32Array||r instanceof Int32Array)&&!e.startsWith("_")&&(console.warn(`GLTFExporter: Attribute "${e}" converted to type FLOAT.`),f=GLTFExporter.Utils.toFloat32BufferAttribute(t)):(console.warn('GLTFExporter: Attribute "skinIndex" converted to type UNSIGNED_SHORT.'),f=new i.TlE(new Uint16Array(r),t.itemSize,t.normalized));let a=this.processAccessor(f||t,l);null!==a&&(e.startsWith("_")||this.detectMeshQuantization(e,t),c[e]=a,s.attributes.set(this.getUID(t),a))}if(void 0!==m&&l.setAttribute("normal",m),0===Object.keys(c).length)return null;if(void 0!==e.morphTargetInfluences&&e.morphTargetInfluences.length>0){let t=[],i=[],n={};if(void 0!==e.morphTargetDictionary)for(let t in e.morphTargetDictionary)n[e.morphTargetDictionary[t]]=t;for(let r=0;r<e.morphTargetInfluences.length;++r){let a={},o=!1;for(let e in l.morphAttributes){if("position"!==e&&"normal"!==e){o||(console.warn("GLTFExporter: Only POSITION and NORMAL morph are supported."),o=!0);continue}let t=l.morphAttributes[e][r],i=e.toUpperCase(),n=l.attributes[e];if(s.attributes.has(this.getUID(t,!0))){a[i]=s.attributes.get(this.getUID(t,!0));continue}let h=t.clone();if(!l.morphTargetsRelative)for(let e=0,s=t.count;e<s;e++)for(let s=0;s<t.itemSize;s++)0===s&&h.setX(e,t.getX(e)-n.getX(e)),1===s&&h.setY(e,t.getY(e)-n.getY(e)),2===s&&h.setZ(e,t.getZ(e)-n.getZ(e)),3===s&&h.setW(e,t.getW(e)-n.getW(e));a[i]=this.processAccessor(h,l),s.attributes.set(this.getUID(n,!0),a[i])}p.push(a),t.push(e.morphTargetInfluences[r]),void 0!==e.morphTargetDictionary&&i.push(n[r])}h.weights=t,i.length>0&&(h.extras={},h.extras.targetNames=i)}let g=Array.isArray(e.material);if(g&&0===l.groups.length)return null;let T=!1;if(g&&null===l.index){let e=[];for(let t=0,s=l.attributes.position.count;t<s;t++)e[t]=t;l.setIndex(e),T=!0}let x=g?e.material:[e.material],A=g?l.groups:[{materialIndex:0,start:void 0,count:void 0}];for(let e=0,i=A.length;e<i;e++){let i={mode:t,attributes:c};if(this.serializeUserData(l,i),p.length>0&&(i.targets=p),null!==l.index){let t=this.getUID(l.index);(void 0!==A[e].start||void 0!==A[e].count)&&(t+=":"+A[e].start+":"+A[e].count),s.attributes.has(t)?i.indices=s.attributes.get(t):(i.indices=this.processAccessor(l.index,l,A[e].start,A[e].count),s.attributes.set(t,i.indices)),null===i.indices&&delete i.indices}let n=await this.processMaterialAsync(x[A[e].materialIndex]);null!==n&&(i.material=n),u.push(i)}!0===T&&l.setIndex(null),h.primitives=u,n.meshes||(n.meshes=[]),await this._invokeAllAsync(function(t){t.writeMesh&&t.writeMesh(e,h)});let y=n.meshes.push(h)-1;return s.meshes.set(o,y),y}detectMeshQuantization(e,t){let s;if(this.extensionsUsed[a])return;switch(t.array.constructor){case Int8Array:s="byte";break;case Uint8Array:s="unsigned byte";break;case Int16Array:s="short";break;case Uint16Array:s="unsigned short";break;default:return}t.normalized&&(s+=" normalized");let i=e.split("_",1)[0];n[i]&&n[i].includes(s)&&(this.extensionsUsed[a]=!0,this.extensionsRequired[a]=!0)}processCamera(e){let t=this.json;t.cameras||(t.cameras=[]);let s=e.isOrthographicCamera,n={type:s?"orthographic":"perspective"};return s?n.orthographic={xmag:2*e.right,ymag:2*e.top,zfar:e.far<=0?.001:e.far,znear:e.near<0?0:e.near}:n.perspective={aspectRatio:e.aspect,yfov:i.M8C.degToRad(e.fov),zfar:e.far<=0?.001:e.far,znear:e.near<0?0:e.near},""!==e.name&&(n.name=e.type),t.cameras.push(n)-1}processAnimation(e,t){let s=this.json,n=this.nodeMap;s.animations||(s.animations=[]),e=GLTFExporter.Utils.mergeMorphTargetTracks(e.clone(),t);let r=e.tracks,a=[],o=[];for(let e=0;e<r.length;++e){let s;let h=r[e],c=i.iUV.parseTrackName(h.name),u=i.iUV.findNode(t,c.nodeName),p=l[c.propertyName];if("bones"===c.objectName&&(u=!0===u.isSkinnedMesh?u.skeleton.getBoneByName(c.objectIndex):void 0),!u||!p){console.warn('THREE.GLTFExporter: Could not export animation track "%s".',h.name);continue}let d=h.values.length/h.times.length;p===l.morphTargetInfluences&&(d/=u.morphTargetInfluences.length),!0===h.createInterpolant.isInterpolantFactoryMethodGLTFCubicSpline?(s="CUBICSPLINE",d/=3):s=h.getInterpolation()===i.Syv?"STEP":"LINEAR",o.push({input:this.processAccessor(new i.TlE(h.times,1)),output:this.processAccessor(new i.TlE(h.values,d)),interpolation:s}),a.push({sampler:o.length-1,target:{node:n.get(u),path:p}})}return s.animations.push({name:e.name||"clip_"+s.animations.length,samplers:o,channels:a}),s.animations.length-1}processSkin(e){let t=this.json,s=this.nodeMap,n=t.nodes[s.get(e)],r=e.skeleton;if(void 0===r)return null;let a=e.skeleton.bones[0];if(void 0===a)return null;let o=[],l=new Float32Array(16*r.bones.length),h=new i.yGw;for(let t=0;t<r.bones.length;++t)o.push(s.get(r.bones[t])),h.copy(r.boneInverses[t]),h.multiply(e.bindMatrix).toArray(l,16*t);void 0===t.skins&&(t.skins=[]),t.skins.push({inverseBindMatrices:this.processAccessor(new i.TlE(l,16)),joints:o,skeleton:s.get(a)});let c=n.skin=t.skins.length-1;return c}async processNodeAsync(e){let t=this.json,s=this.options,i=this.nodeMap;t.nodes||(t.nodes=[]);let n={};if(s.trs){let t=e.quaternion.toArray(),s=e.position.toArray(),i=e.scale.toArray();equalArray(t,[0,0,0,1])||(n.rotation=t),equalArray(s,[0,0,0])||(n.translation=s),equalArray(i,[1,1,1])||(n.scale=i)}else e.matrixAutoUpdate&&e.updateMatrix(),!1===equalArray(e.matrix.elements,[1,0,0,0,0,1,0,0,0,0,1,0,0,0,0,1])&&(n.matrix=e.matrix.elements);if(""!==e.name&&(n.name=String(e.name)),this.serializeUserData(e,n),e.isMesh||e.isLine||e.isPoints){let t=await this.processMeshAsync(e);null!==t&&(n.mesh=t)}else e.isCamera&&(n.camera=this.processCamera(e));if(e.isSkinnedMesh&&this.skins.push(e),e.children.length>0){let t=[];for(let i=0,n=e.children.length;i<n;i++){let n=e.children[i];if(n.visible||!1===s.onlyVisible){let e=await this.processNodeAsync(n);null!==e&&t.push(e)}}t.length>0&&(n.children=t)}await this._invokeAllAsync(function(t){t.writeNode&&t.writeNode(e,n)});let r=t.nodes.push(n)-1;return i.set(e,r),r}async processSceneAsync(e){let t=this.json,s=this.options;t.scenes||(t.scenes=[],t.scene=0);let i={};""!==e.name&&(i.name=e.name),t.scenes.push(i);let n=[];for(let t=0,i=e.children.length;t<i;t++){let i=e.children[t];if(i.visible||!1===s.onlyVisible){let e=await this.processNodeAsync(i);null!==e&&n.push(e)}}n.length>0&&(i.nodes=n),this.serializeUserData(e,i)}async processObjectsAsync(e){let t=new i.xsS;t.name="AuxScene";for(let s=0;s<e.length;s++)t.children.push(e[s]);await this.processSceneAsync(t)}async processInputAsync(e){let t=this.options;e=e instanceof Array?e:[e],await this._invokeAllAsync(function(t){t.beforeParse&&t.beforeParse(e)});let s=[];for(let t=0;t<e.length;t++)e[t]instanceof i.xsS?await this.processSceneAsync(e[t]):s.push(e[t]);s.length>0&&await this.processObjectsAsync(s);for(let e=0;e<this.skins.length;++e)this.processSkin(this.skins[e]);for(let s=0;s<t.animations.length;++s)this.processAnimation(t.animations[s],e[0]);await this._invokeAllAsync(function(t){t.afterParse&&t.afterParse(e)})}async _invokeAllAsync(e){for(let t=0,s=this.plugins.length;t<s;t++)await e(this.plugins[t])}};let GLTFLightExtension=class GLTFLightExtension{constructor(e){this.writer=e,this.name="KHR_lights_punctual"}writeNode(e,t){if(!e.isLight)return;if(!e.isDirectionalLight&&!e.isPointLight&&!e.isSpotLight){console.warn("THREE.GLTFExporter: Only directional, point, and spot lights are supported.",e);return}let s=this.writer,i=s.json,n=s.extensionsUsed,r={};e.name&&(r.name=e.name),r.color=e.color.toArray(),r.intensity=e.intensity,e.isDirectionalLight?r.type="directional":e.isPointLight?(r.type="point",e.distance>0&&(r.range=e.distance)):e.isSpotLight&&(r.type="spot",e.distance>0&&(r.range=e.distance),r.spot={},r.spot.innerConeAngle=(1-e.penumbra)*e.angle,r.spot.outerConeAngle=e.angle),void 0!==e.decay&&2!==e.decay&&console.warn("THREE.GLTFExporter: Light decay may be lost. glTF is physically-based, and expects light.decay=2."),e.target&&(e.target.parent!==e||0!==e.target.position.x||0!==e.target.position.y||-1!==e.target.position.z)&&console.warn("THREE.GLTFExporter: Light direction may be lost. For best results, make light.target a child of the light with position 0,0,-1."),n[this.name]||(i.extensions=i.extensions||{},i.extensions[this.name]={lights:[]},n[this.name]=!0);let a=i.extensions[this.name].lights;a.push(r),t.extensions=t.extensions||{},t.extensions[this.name]={light:a.length-1}}};let GLTFMaterialsUnlitExtension=class GLTFMaterialsUnlitExtension{constructor(e){this.writer=e,this.name="KHR_materials_unlit"}async writeMaterialAsync(e,t){if(!e.isMeshBasicMaterial)return;let s=this.writer,i=s.extensionsUsed;t.extensions=t.extensions||{},t.extensions[this.name]={},i[this.name]=!0,t.pbrMetallicRoughness.metallicFactor=0,t.pbrMetallicRoughness.roughnessFactor=.9}};let GLTFMaterialsClearcoatExtension=class GLTFMaterialsClearcoatExtension{constructor(e){this.writer=e,this.name="KHR_materials_clearcoat"}async writeMaterialAsync(e,t){if(!e.isMeshPhysicalMaterial||0===e.clearcoat)return;let s=this.writer,i=s.extensionsUsed,n={};if(n.clearcoatFactor=e.clearcoat,e.clearcoatMap){let t={index:await s.processTextureAsync(e.clearcoatMap),texCoord:e.clearcoatMap.channel};s.applyTextureTransform(t,e.clearcoatMap),n.clearcoatTexture=t}if(n.clearcoatRoughnessFactor=e.clearcoatRoughness,e.clearcoatRoughnessMap){let t={index:await s.processTextureAsync(e.clearcoatRoughnessMap),texCoord:e.clearcoatRoughnessMap.channel};s.applyTextureTransform(t,e.clearcoatRoughnessMap),n.clearcoatRoughnessTexture=t}if(e.clearcoatNormalMap){let t={index:await s.processTextureAsync(e.clearcoatNormalMap),texCoord:e.clearcoatNormalMap.channel};1!==e.clearcoatNormalScale.x&&(t.scale=e.clearcoatNormalScale.x),s.applyTextureTransform(t,e.clearcoatNormalMap),n.clearcoatNormalTexture=t}t.extensions=t.extensions||{},t.extensions[this.name]=n,i[this.name]=!0}};let GLTFMaterialsDispersionExtension=class GLTFMaterialsDispersionExtension{constructor(e){this.writer=e,this.name="KHR_materials_dispersion"}async writeMaterialAsync(e,t){if(!e.isMeshPhysicalMaterial||0===e.dispersion)return;let s=this.writer,i=s.extensionsUsed,n={};n.dispersion=e.dispersion,t.extensions=t.extensions||{},t.extensions[this.name]=n,i[this.name]=!0}};let GLTFMaterialsIridescenceExtension=class GLTFMaterialsIridescenceExtension{constructor(e){this.writer=e,this.name="KHR_materials_iridescence"}async writeMaterialAsync(e,t){if(!e.isMeshPhysicalMaterial||0===e.iridescence)return;let s=this.writer,i=s.extensionsUsed,n={};if(n.iridescenceFactor=e.iridescence,e.iridescenceMap){let t={index:await s.processTextureAsync(e.iridescenceMap),texCoord:e.iridescenceMap.channel};s.applyTextureTransform(t,e.iridescenceMap),n.iridescenceTexture=t}if(n.iridescenceIor=e.iridescenceIOR,n.iridescenceThicknessMinimum=e.iridescenceThicknessRange[0],n.iridescenceThicknessMaximum=e.iridescenceThicknessRange[1],e.iridescenceThicknessMap){let t={index:await s.processTextureAsync(e.iridescenceThicknessMap),texCoord:e.iridescenceThicknessMap.channel};s.applyTextureTransform(t,e.iridescenceThicknessMap),n.iridescenceThicknessTexture=t}t.extensions=t.extensions||{},t.extensions[this.name]=n,i[this.name]=!0}};let GLTFMaterialsTransmissionExtension=class GLTFMaterialsTransmissionExtension{constructor(e){this.writer=e,this.name="KHR_materials_transmission"}async writeMaterialAsync(e,t){if(!e.isMeshPhysicalMaterial||0===e.transmission)return;let s=this.writer,i=s.extensionsUsed,n={};if(n.transmissionFactor=e.transmission,e.transmissionMap){let t={index:await s.processTextureAsync(e.transmissionMap),texCoord:e.transmissionMap.channel};s.applyTextureTransform(t,e.transmissionMap),n.transmissionTexture=t}t.extensions=t.extensions||{},t.extensions[this.name]=n,i[this.name]=!0}};let GLTFMaterialsVolumeExtension=class GLTFMaterialsVolumeExtension{constructor(e){this.writer=e,this.name="KHR_materials_volume"}async writeMaterialAsync(e,t){if(!e.isMeshPhysicalMaterial||0===e.transmission)return;let s=this.writer,i=s.extensionsUsed,n={};if(n.thicknessFactor=e.thickness,e.thicknessMap){let t={index:await s.processTextureAsync(e.thicknessMap),texCoord:e.thicknessMap.channel};s.applyTextureTransform(t,e.thicknessMap),n.thicknessTexture=t}e.attenuationDistance!==1/0&&(n.attenuationDistance=e.attenuationDistance),n.attenuationColor=e.attenuationColor.toArray(),t.extensions=t.extensions||{},t.extensions[this.name]=n,i[this.name]=!0}};let GLTFMaterialsIorExtension=class GLTFMaterialsIorExtension{constructor(e){this.writer=e,this.name="KHR_materials_ior"}async writeMaterialAsync(e,t){if(!e.isMeshPhysicalMaterial||1.5===e.ior)return;let s=this.writer,i=s.extensionsUsed,n={};n.ior=e.ior,t.extensions=t.extensions||{},t.extensions[this.name]=n,i[this.name]=!0}};let GLTFMaterialsSpecularExtension=class GLTFMaterialsSpecularExtension{constructor(e){this.writer=e,this.name="KHR_materials_specular"}async writeMaterialAsync(e,t){if(!e.isMeshPhysicalMaterial||1===e.specularIntensity&&e.specularColor.equals(h)&&!e.specularIntensityMap&&!e.specularColorMap)return;let s=this.writer,i=s.extensionsUsed,n={};if(e.specularIntensityMap){let t={index:await s.processTextureAsync(e.specularIntensityMap),texCoord:e.specularIntensityMap.channel};s.applyTextureTransform(t,e.specularIntensityMap),n.specularTexture=t}if(e.specularColorMap){let t={index:await s.processTextureAsync(e.specularColorMap),texCoord:e.specularColorMap.channel};s.applyTextureTransform(t,e.specularColorMap),n.specularColorTexture=t}n.specularFactor=e.specularIntensity,n.specularColorFactor=e.specularColor.toArray(),t.extensions=t.extensions||{},t.extensions[this.name]=n,i[this.name]=!0}};let GLTFMaterialsSheenExtension=class GLTFMaterialsSheenExtension{constructor(e){this.writer=e,this.name="KHR_materials_sheen"}async writeMaterialAsync(e,t){if(!e.isMeshPhysicalMaterial||0==e.sheen)return;let s=this.writer,i=s.extensionsUsed,n={};if(e.sheenRoughnessMap){let t={index:await s.processTextureAsync(e.sheenRoughnessMap),texCoord:e.sheenRoughnessMap.channel};s.applyTextureTransform(t,e.sheenRoughnessMap),n.sheenRoughnessTexture=t}if(e.sheenColorMap){let t={index:await s.processTextureAsync(e.sheenColorMap),texCoord:e.sheenColorMap.channel};s.applyTextureTransform(t,e.sheenColorMap),n.sheenColorTexture=t}n.sheenRoughnessFactor=e.sheenRoughness,n.sheenColorFactor=e.sheenColor.toArray(),t.extensions=t.extensions||{},t.extensions[this.name]=n,i[this.name]=!0}};let GLTFMaterialsAnisotropyExtension=class GLTFMaterialsAnisotropyExtension{constructor(e){this.writer=e,this.name="KHR_materials_anisotropy"}async writeMaterialAsync(e,t){if(!e.isMeshPhysicalMaterial||0==e.anisotropy)return;let s=this.writer,i=s.extensionsUsed,n={};if(e.anisotropyMap){let t={index:await s.processTextureAsync(e.anisotropyMap)};s.applyTextureTransform(t,e.anisotropyMap),n.anisotropyTexture=t}n.anisotropyStrength=e.anisotropy,n.anisotropyRotation=e.anisotropyRotation,t.extensions=t.extensions||{},t.extensions[this.name]=n,i[this.name]=!0}};let GLTFMaterialsEmissiveStrengthExtension=class GLTFMaterialsEmissiveStrengthExtension{constructor(e){this.writer=e,this.name="KHR_materials_emissive_strength"}async writeMaterialAsync(e,t){if(!e.isMeshStandardMaterial||1===e.emissiveIntensity)return;let s=this.writer,i=s.extensionsUsed,n={};n.emissiveStrength=e.emissiveIntensity,t.extensions=t.extensions||{},t.extensions[this.name]=n,i[this.name]=!0}};let GLTFMaterialsBumpExtension=class GLTFMaterialsBumpExtension{constructor(e){this.writer=e,this.name="EXT_materials_bump"}async writeMaterialAsync(e,t){if(!e.isMeshStandardMaterial||1===e.bumpScale&&!e.bumpMap)return;let s=this.writer,i=s.extensionsUsed,n={};if(e.bumpMap){let t={index:await s.processTextureAsync(e.bumpMap),texCoord:e.bumpMap.channel};s.applyTextureTransform(t,e.bumpMap),n.bumpTexture=t}n.bumpFactor=e.bumpScale,t.extensions=t.extensions||{},t.extensions[this.name]=n,i[this.name]=!0}};let GLTFMeshGpuInstancing=class GLTFMeshGpuInstancing{constructor(e){this.writer=e,this.name="EXT_mesh_gpu_instancing"}writeNode(e,t){if(!e.isInstancedMesh)return;let s=this.writer,n=new Float32Array(3*e.count),r=new Float32Array(4*e.count),a=new Float32Array(3*e.count),o=new i.yGw,l=new i.Pa4,h=new i._fP,c=new i.Pa4;for(let t=0;t<e.count;t++)e.getMatrixAt(t,o),o.decompose(l,h,c),l.toArray(n,3*t),h.toArray(r,4*t),c.toArray(a,3*t);let u={TRANSLATION:s.processAccessor(new i.TlE(n,3)),ROTATION:s.processAccessor(new i.TlE(r,4)),SCALE:s.processAccessor(new i.TlE(a,3))};e.instanceColor&&(u._COLOR_0=s.processAccessor(e.instanceColor)),t.extensions=t.extensions||{},t.extensions[this.name]={attributes:u},s.extensionsUsed[this.name]=!0,s.extensionsRequired[this.name]=!0}};GLTFExporter.Utils={insertKeyframe:function(e,t){let s;let i=e.getValueSize(),n=new e.TimeBufferType(e.times.length+1),r=new e.ValueBufferType(e.values.length+i),a=e.createInterpolant(new e.ValueBufferType(i));if(0===e.times.length){n[0]=t;for(let e=0;e<i;e++)r[e]=0;s=0}else if(t<e.times[0]){if(.001>Math.abs(e.times[0]-t))return 0;n[0]=t,n.set(e.times,1),r.set(a.evaluate(t),0),r.set(e.values,i),s=0}else if(t>e.times[e.times.length-1]){if(.001>Math.abs(e.times[e.times.length-1]-t))return e.times.length-1;n[n.length-1]=t,n.set(e.times,0),r.set(e.values,0),r.set(a.evaluate(t),e.values.length),s=n.length-1}else for(let o=0;o<e.times.length;o++){if(.001>Math.abs(e.times[o]-t))return o;if(e.times[o]<t&&e.times[o+1]>t){n.set(e.times.slice(0,o+1),0),n[o+1]=t,n.set(e.times.slice(o+1),o+2),r.set(e.values.slice(0,(o+1)*i),0),r.set(a.evaluate(t),(o+1)*i),r.set(e.values.slice((o+1)*i),(o+2)*i),s=o+1;break}}return e.times=n,e.values=r,s},mergeMorphTargetTracks:function(e,t){let s=[],n={},r=e.tracks;for(let e=0;e<r.length;++e){let a,o=r[e],l=i.iUV.parseTrackName(o.name),h=i.iUV.findNode(t,l.nodeName);if("morphTargetInfluences"!==l.propertyName||void 0===l.propertyIndex){s.push(o);continue}if(o.createInterpolant!==o.InterpolantFactoryMethodDiscrete&&o.createInterpolant!==o.InterpolantFactoryMethodLinear){if(o.createInterpolant.isInterpolantFactoryMethodGLTFCubicSpline)throw Error("THREE.GLTFExporter: Cannot merge tracks with glTF CUBICSPLINE interpolation.");console.warn("THREE.GLTFExporter: Morph target interpolation mode not yet supported. Using LINEAR instead."),(o=o.clone()).setInterpolation(i.NMF)}let c=h.morphTargetInfluences.length,u=h.morphTargetDictionary[l.propertyIndex];if(void 0===u)throw Error("THREE.GLTFExporter: Morph target name not found: "+l.propertyIndex);if(void 0===n[h.uuid]){a=o.clone();let e=new a.ValueBufferType(c*a.times.length);for(let t=0;t<a.times.length;t++)e[t*c+u]=a.values[t];a.name=(l.nodeName||"")+".morphTargetInfluences",a.values=e,n[h.uuid]=a,s.push(a);continue}let p=o.createInterpolant(new o.ValueBufferType(1));a=n[h.uuid];for(let e=0;e<a.times.length;e++)a.values[e*c+u]=p.evaluate(a.times[e]);for(let e=0;e<o.times.length;e++){let t=this.insertKeyframe(a,o.times[e]);a.values[t*c+u]=o.values[e]}}return e.tracks=s,e},toFloat32BufferAttribute:function(e){let t=new i.TlE(new Float32Array(e.count*e.itemSize),e.itemSize,!1);if(!e.normalized&&!e.isInterleavedBufferAttribute)return t.array.set(e.array),t;for(let s=0,i=e.count;s<i;s++)for(let i=0;i<e.itemSize;i++)t.setComponent(s,i,e.getComponent(s,i));return t}}},4863:function(e,t,s){s.d(t,{E:function(){return GLTFLoader}});var i=s(2461);function toTrianglesDrawMode(e,t){if(t===i.WwZ)return console.warn("THREE.BufferGeometryUtils.toTrianglesDrawMode(): Geometry already defined as triangles."),e;if(t!==i.z$h&&t!==i.UlW)return console.error("THREE.BufferGeometryUtils.toTrianglesDrawMode(): Unknown draw mode:",t),e;{let s=e.getIndex();if(null===s){let t=[],i=e.getAttribute("position");if(void 0===i)return console.error("THREE.BufferGeometryUtils.toTrianglesDrawMode(): Undefined position attribute. Processing not possible."),e;for(let e=0;e<i.count;e++)t.push(e);e.setIndex(t),s=e.getIndex()}let n=s.count-2,r=[];if(t===i.z$h)for(let e=1;e<=n;e++)r.push(s.getX(0)),r.push(s.getX(e)),r.push(s.getX(e+1));else for(let e=0;e<n;e++)e%2==0?(r.push(s.getX(e)),r.push(s.getX(e+1)),r.push(s.getX(e+2))):(r.push(s.getX(e+2)),r.push(s.getX(e+1)),r.push(s.getX(e)));r.length/3!==n&&console.error("THREE.BufferGeometryUtils.toTrianglesDrawMode(): Unable to generate correct amount of triangles.");let a=e.clone();return a.setIndex(r),a.clearGroups(),a}}let GLTFLoader=class GLTFLoader extends i.aNw{constructor(e){super(e),this.dracoLoader=null,this.ktx2Loader=null,this.meshoptDecoder=null,this.pluginCallbacks=[],this.register(function(e){return new GLTFMaterialsClearcoatExtension(e)}),this.register(function(e){return new GLTFMaterialsDispersionExtension(e)}),this.register(function(e){return new GLTFTextureBasisUExtension(e)}),this.register(function(e){return new GLTFTextureWebPExtension(e)}),this.register(function(e){return new GLTFTextureAVIFExtension(e)}),this.register(function(e){return new GLTFMaterialsSheenExtension(e)}),this.register(function(e){return new GLTFMaterialsTransmissionExtension(e)}),this.register(function(e){return new GLTFMaterialsVolumeExtension(e)}),this.register(function(e){return new GLTFMaterialsIorExtension(e)}),this.register(function(e){return new GLTFMaterialsEmissiveStrengthExtension(e)}),this.register(function(e){return new GLTFMaterialsSpecularExtension(e)}),this.register(function(e){return new GLTFMaterialsIridescenceExtension(e)}),this.register(function(e){return new GLTFMaterialsAnisotropyExtension(e)}),this.register(function(e){return new GLTFMaterialsBumpExtension(e)}),this.register(function(e){return new GLTFLightsExtension(e)}),this.register(function(e){return new GLTFMeshoptCompression(e)}),this.register(function(e){return new GLTFMeshGpuInstancing(e)})}load(e,t,s,n){let r;let a=this;if(""!==this.resourcePath)r=this.resourcePath;else if(""!==this.path){let t=i.Zp0.extractUrlBase(e);r=i.Zp0.resolveURL(t,this.path)}else r=i.Zp0.extractUrlBase(e);this.manager.itemStart(e);let _onError=function(t){n?n(t):console.error(t),a.manager.itemError(e),a.manager.itemEnd(e)},o=new i.hH6(this.manager);o.setPath(this.path),o.setResponseType("arraybuffer"),o.setRequestHeader(this.requestHeader),o.setWithCredentials(this.withCredentials),o.load(e,function(s){try{a.parse(s,r,function(s){t(s),a.manager.itemEnd(e)},_onError)}catch(e){_onError(e)}},s,_onError)}setDRACOLoader(e){return this.dracoLoader=e,this}setKTX2Loader(e){return this.ktx2Loader=e,this}setMeshoptDecoder(e){return this.meshoptDecoder=e,this}register(e){return -1===this.pluginCallbacks.indexOf(e)&&this.pluginCallbacks.push(e),this}unregister(e){return -1!==this.pluginCallbacks.indexOf(e)&&this.pluginCallbacks.splice(this.pluginCallbacks.indexOf(e),1),this}parse(e,t,s,i){let a;let o={},l={},h=new TextDecoder;if("string"==typeof e)a=JSON.parse(e);else if(e instanceof ArrayBuffer){let t=h.decode(new Uint8Array(e,0,4));if(t===r){try{o[n.KHR_BINARY_GLTF]=new GLTFBinaryExtension(e)}catch(e){i&&i(e);return}a=JSON.parse(o[n.KHR_BINARY_GLTF].content)}else a=JSON.parse(h.decode(e))}else a=e;if(void 0===a.asset||a.asset.version[0]<2){i&&i(Error("THREE.GLTFLoader: Unsupported asset. glTF versions >=2.0 are supported."));return}let c=new GLTFParser(a,{path:t||this.resourcePath||"",crossOrigin:this.crossOrigin,requestHeader:this.requestHeader,manager:this.manager,ktx2Loader:this.ktx2Loader,meshoptDecoder:this.meshoptDecoder});c.fileLoader.setRequestHeader(this.requestHeader);for(let e=0;e<this.pluginCallbacks.length;e++){let t=this.pluginCallbacks[e](c);t.name||console.error("THREE.GLTFLoader: Invalid plugin found: missing name"),l[t.name]=t,o[t.name]=!0}if(a.extensionsUsed)for(let e=0;e<a.extensionsUsed.length;++e){let t=a.extensionsUsed[e],s=a.extensionsRequired||[];switch(t){case n.KHR_MATERIALS_UNLIT:o[t]=new GLTFMaterialsUnlitExtension;break;case n.KHR_DRACO_MESH_COMPRESSION:o[t]=new GLTFDracoMeshCompressionExtension(a,this.dracoLoader);break;case n.KHR_TEXTURE_TRANSFORM:o[t]=new GLTFTextureTransformExtension;break;case n.KHR_MESH_QUANTIZATION:o[t]=new GLTFMeshQuantizationExtension;break;default:s.indexOf(t)>=0&&void 0===l[t]&&console.warn('THREE.GLTFLoader: Unknown extension "'+t+'".')}}c.setExtensions(o),c.setPlugins(l),c.parse(s,i)}parseAsync(e,t){let s=this;return new Promise(function(i,n){s.parse(e,t,i,n)})}};function GLTFRegistry(){let e={};return{get:function(t){return e[t]},add:function(t,s){e[t]=s},remove:function(t){delete e[t]},removeAll:function(){e={}}}}let n={KHR_BINARY_GLTF:"KHR_binary_glTF",KHR_DRACO_MESH_COMPRESSION:"KHR_draco_mesh_compression",KHR_LIGHTS_PUNCTUAL:"KHR_lights_punctual",KHR_MATERIALS_CLEARCOAT:"KHR_materials_clearcoat",KHR_MATERIALS_DISPERSION:"KHR_materials_dispersion",KHR_MATERIALS_IOR:"KHR_materials_ior",KHR_MATERIALS_SHEEN:"KHR_materials_sheen",KHR_MATERIALS_SPECULAR:"KHR_materials_specular",KHR_MATERIALS_TRANSMISSION:"KHR_materials_transmission",KHR_MATERIALS_IRIDESCENCE:"KHR_materials_iridescence",KHR_MATERIALS_ANISOTROPY:"KHR_materials_anisotropy",KHR_MATERIALS_UNLIT:"KHR_materials_unlit",KHR_MATERIALS_VOLUME:"KHR_materials_volume",KHR_TEXTURE_BASISU:"KHR_texture_basisu",KHR_TEXTURE_TRANSFORM:"KHR_texture_transform",KHR_MESH_QUANTIZATION:"KHR_mesh_quantization",KHR_MATERIALS_EMISSIVE_STRENGTH:"KHR_materials_emissive_strength",EXT_MATERIALS_BUMP:"EXT_materials_bump",EXT_TEXTURE_WEBP:"EXT_texture_webp",EXT_TEXTURE_AVIF:"EXT_texture_avif",EXT_MESHOPT_COMPRESSION:"EXT_meshopt_compression",EXT_MESH_GPU_INSTANCING:"EXT_mesh_gpu_instancing"};let GLTFLightsExtension=class GLTFLightsExtension{constructor(e){this.parser=e,this.name=n.KHR_LIGHTS_PUNCTUAL,this.cache={refs:{},uses:{}}}_markDefs(){let e=this.parser,t=this.parser.json.nodes||[];for(let s=0,i=t.length;s<i;s++){let i=t[s];i.extensions&&i.extensions[this.name]&&void 0!==i.extensions[this.name].light&&e._addNodeRef(this.cache,i.extensions[this.name].light)}}_loadLight(e){let t;let s=this.parser,n="light:"+e,r=s.cache.get(n);if(r)return r;let a=s.json,o=a.extensions&&a.extensions[this.name]||{},l=o.lights||[],h=l[e],c=new i.Ilk(16777215);void 0!==h.color&&c.setRGB(h.color[0],h.color[1],h.color[2],i.GUF);let u=void 0!==h.range?h.range:0;switch(h.type){case"directional":(t=new i.Ox3(c)).target.position.set(0,0,-1),t.add(t.target);break;case"point":(t=new i.cek(c)).distance=u;break;case"spot":(t=new i.PMe(c)).distance=u,h.spot=h.spot||{},h.spot.innerConeAngle=void 0!==h.spot.innerConeAngle?h.spot.innerConeAngle:0,h.spot.outerConeAngle=void 0!==h.spot.outerConeAngle?h.spot.outerConeAngle:Math.PI/4,t.angle=h.spot.outerConeAngle,t.penumbra=1-h.spot.innerConeAngle/h.spot.outerConeAngle,t.target.position.set(0,0,-1),t.add(t.target);break;default:throw Error("THREE.GLTFLoader: Unexpected light type: "+h.type)}return t.position.set(0,0,0),t.decay=2,assignExtrasToUserData(t,h),void 0!==h.intensity&&(t.intensity=h.intensity),t.name=s.createUniqueName(h.name||"light_"+e),r=Promise.resolve(t),s.cache.add(n,r),r}getDependency(e,t){if("light"===e)return this._loadLight(t)}createNodeAttachment(e){let t=this,s=this.parser,i=s.json,n=i.nodes[e],r=n.extensions&&n.extensions[this.name]||{},a=r.light;return void 0===a?null:this._loadLight(a).then(function(e){return s._getNodeRef(t.cache,a,e)})}};let GLTFMaterialsUnlitExtension=class GLTFMaterialsUnlitExtension{constructor(){this.name=n.KHR_MATERIALS_UNLIT}getMaterialType(){return i.vBJ}extendParams(e,t,s){let n=[];e.color=new i.Ilk(1,1,1),e.opacity=1;let r=t.pbrMetallicRoughness;if(r){if(Array.isArray(r.baseColorFactor)){let t=r.baseColorFactor;e.color.setRGB(t[0],t[1],t[2],i.GUF),e.opacity=t[3]}void 0!==r.baseColorTexture&&n.push(s.assignTexture(e,"map",r.baseColorTexture,i.KI_))}return Promise.all(n)}};let GLTFMaterialsEmissiveStrengthExtension=class GLTFMaterialsEmissiveStrengthExtension{constructor(e){this.parser=e,this.name=n.KHR_MATERIALS_EMISSIVE_STRENGTH}extendMaterialParams(e,t){let s=this.parser,i=s.json.materials[e];if(!i.extensions||!i.extensions[this.name])return Promise.resolve();let n=i.extensions[this.name].emissiveStrength;return void 0!==n&&(t.emissiveIntensity=n),Promise.resolve()}};let GLTFMaterialsClearcoatExtension=class GLTFMaterialsClearcoatExtension{constructor(e){this.parser=e,this.name=n.KHR_MATERIALS_CLEARCOAT}getMaterialType(e){let t=this.parser,s=t.json.materials[e];return s.extensions&&s.extensions[this.name]?i.EJi:null}extendMaterialParams(e,t){let s=this.parser,n=s.json.materials[e];if(!n.extensions||!n.extensions[this.name])return Promise.resolve();let r=[],a=n.extensions[this.name];if(void 0!==a.clearcoatFactor&&(t.clearcoat=a.clearcoatFactor),void 0!==a.clearcoatTexture&&r.push(s.assignTexture(t,"clearcoatMap",a.clearcoatTexture)),void 0!==a.clearcoatRoughnessFactor&&(t.clearcoatRoughness=a.clearcoatRoughnessFactor),void 0!==a.clearcoatRoughnessTexture&&r.push(s.assignTexture(t,"clearcoatRoughnessMap",a.clearcoatRoughnessTexture)),void 0!==a.clearcoatNormalTexture&&(r.push(s.assignTexture(t,"clearcoatNormalMap",a.clearcoatNormalTexture)),void 0!==a.clearcoatNormalTexture.scale)){let e=a.clearcoatNormalTexture.scale;t.clearcoatNormalScale=new i.FM8(e,e)}return Promise.all(r)}};let GLTFMaterialsDispersionExtension=class GLTFMaterialsDispersionExtension{constructor(e){this.parser=e,this.name=n.KHR_MATERIALS_DISPERSION}getMaterialType(e){let t=this.parser,s=t.json.materials[e];return s.extensions&&s.extensions[this.name]?i.EJi:null}extendMaterialParams(e,t){let s=this.parser,i=s.json.materials[e];if(!i.extensions||!i.extensions[this.name])return Promise.resolve();let n=i.extensions[this.name];return t.dispersion=void 0!==n.dispersion?n.dispersion:0,Promise.resolve()}};let GLTFMaterialsIridescenceExtension=class GLTFMaterialsIridescenceExtension{constructor(e){this.parser=e,this.name=n.KHR_MATERIALS_IRIDESCENCE}getMaterialType(e){let t=this.parser,s=t.json.materials[e];return s.extensions&&s.extensions[this.name]?i.EJi:null}extendMaterialParams(e,t){let s=this.parser,i=s.json.materials[e];if(!i.extensions||!i.extensions[this.name])return Promise.resolve();let n=[],r=i.extensions[this.name];return void 0!==r.iridescenceFactor&&(t.iridescence=r.iridescenceFactor),void 0!==r.iridescenceTexture&&n.push(s.assignTexture(t,"iridescenceMap",r.iridescenceTexture)),void 0!==r.iridescenceIor&&(t.iridescenceIOR=r.iridescenceIor),void 0===t.iridescenceThicknessRange&&(t.iridescenceThicknessRange=[100,400]),void 0!==r.iridescenceThicknessMinimum&&(t.iridescenceThicknessRange[0]=r.iridescenceThicknessMinimum),void 0!==r.iridescenceThicknessMaximum&&(t.iridescenceThicknessRange[1]=r.iridescenceThicknessMaximum),void 0!==r.iridescenceThicknessTexture&&n.push(s.assignTexture(t,"iridescenceThicknessMap",r.iridescenceThicknessTexture)),Promise.all(n)}};let GLTFMaterialsSheenExtension=class GLTFMaterialsSheenExtension{constructor(e){this.parser=e,this.name=n.KHR_MATERIALS_SHEEN}getMaterialType(e){let t=this.parser,s=t.json.materials[e];return s.extensions&&s.extensions[this.name]?i.EJi:null}extendMaterialParams(e,t){let s=this.parser,n=s.json.materials[e];if(!n.extensions||!n.extensions[this.name])return Promise.resolve();let r=[];t.sheenColor=new i.Ilk(0,0,0),t.sheenRoughness=0,t.sheen=1;let a=n.extensions[this.name];if(void 0!==a.sheenColorFactor){let e=a.sheenColorFactor;t.sheenColor.setRGB(e[0],e[1],e[2],i.GUF)}return void 0!==a.sheenRoughnessFactor&&(t.sheenRoughness=a.sheenRoughnessFactor),void 0!==a.sheenColorTexture&&r.push(s.assignTexture(t,"sheenColorMap",a.sheenColorTexture,i.KI_)),void 0!==a.sheenRoughnessTexture&&r.push(s.assignTexture(t,"sheenRoughnessMap",a.sheenRoughnessTexture)),Promise.all(r)}};let GLTFMaterialsTransmissionExtension=class GLTFMaterialsTransmissionExtension{constructor(e){this.parser=e,this.name=n.KHR_MATERIALS_TRANSMISSION}getMaterialType(e){let t=this.parser,s=t.json.materials[e];return s.extensions&&s.extensions[this.name]?i.EJi:null}extendMaterialParams(e,t){let s=this.parser,i=s.json.materials[e];if(!i.extensions||!i.extensions[this.name])return Promise.resolve();let n=[],r=i.extensions[this.name];return void 0!==r.transmissionFactor&&(t.transmission=r.transmissionFactor),void 0!==r.transmissionTexture&&n.push(s.assignTexture(t,"transmissionMap",r.transmissionTexture)),Promise.all(n)}};let GLTFMaterialsVolumeExtension=class GLTFMaterialsVolumeExtension{constructor(e){this.parser=e,this.name=n.KHR_MATERIALS_VOLUME}getMaterialType(e){let t=this.parser,s=t.json.materials[e];return s.extensions&&s.extensions[this.name]?i.EJi:null}extendMaterialParams(e,t){let s=this.parser,n=s.json.materials[e];if(!n.extensions||!n.extensions[this.name])return Promise.resolve();let r=[],a=n.extensions[this.name];t.thickness=void 0!==a.thicknessFactor?a.thicknessFactor:0,void 0!==a.thicknessTexture&&r.push(s.assignTexture(t,"thicknessMap",a.thicknessTexture)),t.attenuationDistance=a.attenuationDistance||1/0;let o=a.attenuationColor||[1,1,1];return t.attenuationColor=new i.Ilk().setRGB(o[0],o[1],o[2],i.GUF),Promise.all(r)}};let GLTFMaterialsIorExtension=class GLTFMaterialsIorExtension{constructor(e){this.parser=e,this.name=n.KHR_MATERIALS_IOR}getMaterialType(e){let t=this.parser,s=t.json.materials[e];return s.extensions&&s.extensions[this.name]?i.EJi:null}extendMaterialParams(e,t){let s=this.parser,i=s.json.materials[e];if(!i.extensions||!i.extensions[this.name])return Promise.resolve();let n=i.extensions[this.name];return t.ior=void 0!==n.ior?n.ior:1.5,Promise.resolve()}};let GLTFMaterialsSpecularExtension=class GLTFMaterialsSpecularExtension{constructor(e){this.parser=e,this.name=n.KHR_MATERIALS_SPECULAR}getMaterialType(e){let t=this.parser,s=t.json.materials[e];return s.extensions&&s.extensions[this.name]?i.EJi:null}extendMaterialParams(e,t){let s=this.parser,n=s.json.materials[e];if(!n.extensions||!n.extensions[this.name])return Promise.resolve();let r=[],a=n.extensions[this.name];t.specularIntensity=void 0!==a.specularFactor?a.specularFactor:1,void 0!==a.specularTexture&&r.push(s.assignTexture(t,"specularIntensityMap",a.specularTexture));let o=a.specularColorFactor||[1,1,1];return t.specularColor=new i.Ilk().setRGB(o[0],o[1],o[2],i.GUF),void 0!==a.specularColorTexture&&r.push(s.assignTexture(t,"specularColorMap",a.specularColorTexture,i.KI_)),Promise.all(r)}};let GLTFMaterialsBumpExtension=class GLTFMaterialsBumpExtension{constructor(e){this.parser=e,this.name=n.EXT_MATERIALS_BUMP}getMaterialType(e){let t=this.parser,s=t.json.materials[e];return s.extensions&&s.extensions[this.name]?i.EJi:null}extendMaterialParams(e,t){let s=this.parser,i=s.json.materials[e];if(!i.extensions||!i.extensions[this.name])return Promise.resolve();let n=[],r=i.extensions[this.name];return t.bumpScale=void 0!==r.bumpFactor?r.bumpFactor:1,void 0!==r.bumpTexture&&n.push(s.assignTexture(t,"bumpMap",r.bumpTexture)),Promise.all(n)}};let GLTFMaterialsAnisotropyExtension=class GLTFMaterialsAnisotropyExtension{constructor(e){this.parser=e,this.name=n.KHR_MATERIALS_ANISOTROPY}getMaterialType(e){let t=this.parser,s=t.json.materials[e];return s.extensions&&s.extensions[this.name]?i.EJi:null}extendMaterialParams(e,t){let s=this.parser,i=s.json.materials[e];if(!i.extensions||!i.extensions[this.name])return Promise.resolve();let n=[],r=i.extensions[this.name];return void 0!==r.anisotropyStrength&&(t.anisotropy=r.anisotropyStrength),void 0!==r.anisotropyRotation&&(t.anisotropyRotation=r.anisotropyRotation),void 0!==r.anisotropyTexture&&n.push(s.assignTexture(t,"anisotropyMap",r.anisotropyTexture)),Promise.all(n)}};let GLTFTextureBasisUExtension=class GLTFTextureBasisUExtension{constructor(e){this.parser=e,this.name=n.KHR_TEXTURE_BASISU}loadTexture(e){let t=this.parser,s=t.json,i=s.textures[e];if(!i.extensions||!i.extensions[this.name])return null;let n=i.extensions[this.name],r=t.options.ktx2Loader;if(!r){if(!(s.extensionsRequired&&s.extensionsRequired.indexOf(this.name)>=0))return null;throw Error("THREE.GLTFLoader: setKTX2Loader must be called before loading KTX2 textures")}return t.loadTextureImage(e,n.source,r)}};let GLTFTextureWebPExtension=class GLTFTextureWebPExtension{constructor(e){this.parser=e,this.name=n.EXT_TEXTURE_WEBP,this.isSupported=null}loadTexture(e){let t=this.name,s=this.parser,i=s.json,n=i.textures[e];if(!n.extensions||!n.extensions[t])return null;let r=n.extensions[t],a=i.images[r.source],o=s.textureLoader;if(a.uri){let e=s.options.manager.getHandler(a.uri);null!==e&&(o=e)}return this.detectSupport().then(function(n){if(n)return s.loadTextureImage(e,r.source,o);if(i.extensionsRequired&&i.extensionsRequired.indexOf(t)>=0)throw Error("THREE.GLTFLoader: WebP required by asset but unsupported.");return s.loadTexture(e)})}detectSupport(){return this.isSupported||(this.isSupported=new Promise(function(e){let t=new Image;t.src="data:image/webp;base64,UklGRiIAAABXRUJQVlA4IBYAAAAwAQCdASoBAAEADsD+JaQAA3AAAAAA",t.onload=t.onerror=function(){e(1===t.height)}})),this.isSupported}};let GLTFTextureAVIFExtension=class GLTFTextureAVIFExtension{constructor(e){this.parser=e,this.name=n.EXT_TEXTURE_AVIF,this.isSupported=null}loadTexture(e){let t=this.name,s=this.parser,i=s.json,n=i.textures[e];if(!n.extensions||!n.extensions[t])return null;let r=n.extensions[t],a=i.images[r.source],o=s.textureLoader;if(a.uri){let e=s.options.manager.getHandler(a.uri);null!==e&&(o=e)}return this.detectSupport().then(function(n){if(n)return s.loadTextureImage(e,r.source,o);if(i.extensionsRequired&&i.extensionsRequired.indexOf(t)>=0)throw Error("THREE.GLTFLoader: AVIF required by asset but unsupported.");return s.loadTexture(e)})}detectSupport(){return this.isSupported||(this.isSupported=new Promise(function(e){let t=new Image;t.src="data:image/avif;base64,AAAAIGZ0eXBhdmlmAAAAAGF2aWZtaWYxbWlhZk1BMUIAAADybWV0YQAAAAAAAAAoaGRscgAAAAAAAAAAcGljdAAAAAAAAAAAAAAAAGxpYmF2aWYAAAAADnBpdG0AAAAAAAEAAAAeaWxvYwAAAABEAAABAAEAAAABAAABGgAAABcAAAAoaWluZgAAAAAAAQAAABppbmZlAgAAAAABAABhdjAxQ29sb3IAAAAAamlwcnAAAABLaXBjbwAAABRpc3BlAAAAAAAAAAEAAAABAAAAEHBpeGkAAAAAAwgICAAAAAxhdjFDgQAMAAAAABNjb2xybmNseAACAAIABoAAAAAXaXBtYQAAAAAAAAABAAEEAQKDBAAAAB9tZGF0EgAKCBgABogQEDQgMgkQAAAAB8dSLfI=",t.onload=t.onerror=function(){e(1===t.height)}})),this.isSupported}};let GLTFMeshoptCompression=class GLTFMeshoptCompression{constructor(e){this.name=n.EXT_MESHOPT_COMPRESSION,this.parser=e}loadBufferView(e){let t=this.parser.json,s=t.bufferViews[e];if(!s.extensions||!s.extensions[this.name])return null;{let e=s.extensions[this.name],i=this.parser.getDependency("buffer",e.buffer),n=this.parser.options.meshoptDecoder;if(!n||!n.supported){if(!(t.extensionsRequired&&t.extensionsRequired.indexOf(this.name)>=0))return null;throw Error("THREE.GLTFLoader: setMeshoptDecoder must be called before loading compressed files")}return i.then(function(t){let s=e.byteOffset||0,i=e.byteLength||0,r=e.count,a=e.byteStride,o=new Uint8Array(t,s,i);return n.decodeGltfBufferAsync?n.decodeGltfBufferAsync(r,a,o,e.mode,e.filter).then(function(e){return e.buffer}):n.ready.then(function(){let t=new ArrayBuffer(r*a);return n.decodeGltfBuffer(new Uint8Array(t),r,a,o,e.mode,e.filter),t})})}}};let GLTFMeshGpuInstancing=class GLTFMeshGpuInstancing{constructor(e){this.name=n.EXT_MESH_GPU_INSTANCING,this.parser=e}createNodeMesh(e){let t=this.parser.json,s=t.nodes[e];if(!s.extensions||!s.extensions[this.name]||void 0===s.mesh)return null;let n=t.meshes[s.mesh];for(let e of n.primitives)if(e.mode!==l.TRIANGLES&&e.mode!==l.TRIANGLE_STRIP&&e.mode!==l.TRIANGLE_FAN&&void 0!==e.mode)return null;let r=s.extensions[this.name],a=r.attributes,o=[],h={};for(let e in a)o.push(this.parser.getDependency("accessor",a[e]).then(t=>(h[e]=t,h[e])));return o.length<1?null:(o.push(this.parser.createNodeMesh(e)),Promise.all(o).then(e=>{let t=e.pop(),s=t.isGroup?t.children:[t],n=e[0].count,r=[];for(let e of s){let t=new i.yGw,s=new i.Pa4,a=new i._fP,o=new i.Pa4(1,1,1),l=new i.SPe(e.geometry,e.material,n);for(let e=0;e<n;e++)h.TRANSLATION&&s.fromBufferAttribute(h.TRANSLATION,e),h.ROTATION&&a.fromBufferAttribute(h.ROTATION,e),h.SCALE&&o.fromBufferAttribute(h.SCALE,e),l.setMatrixAt(e,t.compose(s,a,o));for(let t in h)if("_COLOR_0"===t){let e=h[t];l.instanceColor=new i.lb7(e.array,e.itemSize,e.normalized)}else"TRANSLATION"!==t&&"ROTATION"!==t&&"SCALE"!==t&&e.geometry.setAttribute(t,h[t]);i.Tme.prototype.copy.call(l,e),this.parser.assignFinalMaterial(l),r.push(l)}return t.isGroup?(t.clear(),t.add(...r),t):r[0]}))}};let r="glTF",a={JSON:1313821514,BIN:5130562};let GLTFBinaryExtension=class GLTFBinaryExtension{constructor(e){this.name=n.KHR_BINARY_GLTF,this.content=null,this.body=null;let t=new DataView(e,0,12),s=new TextDecoder;if(this.header={magic:s.decode(new Uint8Array(e.slice(0,4))),version:t.getUint32(4,!0),length:t.getUint32(8,!0)},this.header.magic!==r)throw Error("THREE.GLTFLoader: Unsupported glTF-Binary header.");if(this.header.version<2)throw Error("THREE.GLTFLoader: Legacy binary file detected.");let i=this.header.length-12,o=new DataView(e,12),l=0;for(;l<i;){let t=o.getUint32(l,!0);l+=4;let i=o.getUint32(l,!0);if(l+=4,i===a.JSON){let i=new Uint8Array(e,12+l,t);this.content=s.decode(i)}else if(i===a.BIN){let s=12+l;this.body=e.slice(s,s+t)}l+=t}if(null===this.content)throw Error("THREE.GLTFLoader: JSON content not found.")}};let GLTFDracoMeshCompressionExtension=class GLTFDracoMeshCompressionExtension{constructor(e,t){if(!t)throw Error("THREE.GLTFLoader: No DRACOLoader instance provided.");this.name=n.KHR_DRACO_MESH_COMPRESSION,this.json=e,this.dracoLoader=t,this.dracoLoader.preload()}decodePrimitive(e,t){let s=this.json,n=this.dracoLoader,r=e.extensions[this.name].bufferView,a=e.extensions[this.name].attributes,o={},l={},c={};for(let e in a){let t=d[e]||e.toLowerCase();o[t]=a[e]}for(let t in e.attributes){let i=d[t]||t.toLowerCase();if(void 0!==a[t]){let n=s.accessors[e.attributes[t]],r=h[n.componentType];c[i]=r.name,l[i]=!0===n.normalized}}return t.getDependency("bufferView",r).then(function(e){return new Promise(function(t,s){n.decodeDracoFile(e,function(e){for(let t in e.attributes){let s=e.attributes[t],i=l[t];void 0!==i&&(s.normalized=i)}t(e)},o,c,i.GUF,s)})})}};let GLTFTextureTransformExtension=class GLTFTextureTransformExtension{constructor(){this.name=n.KHR_TEXTURE_TRANSFORM}extendTexture(e,t){return(void 0===t.texCoord||t.texCoord===e.channel)&&void 0===t.offset&&void 0===t.rotation&&void 0===t.scale||(e=e.clone(),void 0!==t.texCoord&&(e.channel=t.texCoord),void 0!==t.offset&&e.offset.fromArray(t.offset),void 0!==t.rotation&&(e.rotation=t.rotation),void 0!==t.scale&&e.repeat.fromArray(t.scale),e.needsUpdate=!0),e}};let GLTFMeshQuantizationExtension=class GLTFMeshQuantizationExtension{constructor(){this.name=n.KHR_MESH_QUANTIZATION}};let GLTFCubicSplineInterpolant=class GLTFCubicSplineInterpolant extends i._C8{constructor(e,t,s,i){super(e,t,s,i)}copySampleValue_(e){let t=this.resultBuffer,s=this.sampleValues,i=this.valueSize,n=e*i*3+i;for(let e=0;e!==i;e++)t[e]=s[n+e];return t}interpolate_(e,t,s,i){let n=this.resultBuffer,r=this.sampleValues,a=this.valueSize,o=2*a,l=3*a,h=i-t,c=(s-t)/h,u=c*c,p=u*c,d=e*l,m=d-l,f=-2*p+3*u,g=p-u,T=1-f,x=g-u+c;for(let e=0;e!==a;e++){let t=r[m+e+a],s=r[m+e+o]*h,i=r[d+e+a],l=r[d+e]*h;n[e]=T*t+x*s+f*i+g*l}return n}};let o=new i._fP;let GLTFCubicSplineQuaternionInterpolant=class GLTFCubicSplineQuaternionInterpolant extends GLTFCubicSplineInterpolant{interpolate_(e,t,s,i){let n=super.interpolate_(e,t,s,i);return o.fromArray(n).normalize().toArray(n),n}};let l={POINTS:0,LINES:1,LINE_LOOP:2,LINE_STRIP:3,TRIANGLES:4,TRIANGLE_STRIP:5,TRIANGLE_FAN:6},h={5120:Int8Array,5121:Uint8Array,5122:Int16Array,5123:Uint16Array,5125:Uint32Array,5126:Float32Array},c={9728:i.TyD,9729:i.wem,9984:i.YLQ,9985:i.qyh,9986:i.aH4,9987:i.D1R},u={33071:i.uWy,33648:i.OoA,10497:i.rpg},p={SCALAR:1,VEC2:2,VEC3:3,VEC4:4,MAT2:4,MAT3:9,MAT4:16},d={POSITION:"position",NORMAL:"normal",TANGENT:"tangent",TEXCOORD_0:"uv",TEXCOORD_1:"uv1",TEXCOORD_2:"uv2",TEXCOORD_3:"uv3",COLOR_0:"color",WEIGHTS_0:"skinWeight",JOINTS_0:"skinIndex"},m={scale:"scale",translation:"position",rotation:"quaternion",weights:"morphTargetInfluences"},f={CUBICSPLINE:void 0,LINEAR:i.NMF,STEP:i.Syv},g={OPAQUE:"OPAQUE",MASK:"MASK",BLEND:"BLEND"};function addUnknownExtensionsToUserData(e,t,s){for(let i in s.extensions)void 0===e[i]&&(t.userData.gltfExtensions=t.userData.gltfExtensions||{},t.userData.gltfExtensions[i]=s.extensions[i])}function assignExtrasToUserData(e,t){void 0!==t.extras&&("object"==typeof t.extras?Object.assign(e.userData,t.extras):console.warn("THREE.GLTFLoader: Ignoring primitive type .extras, "+t.extras))}function createAttributesKey(e){let t="",s=Object.keys(e).sort();for(let i=0,n=s.length;i<n;i++)t+=s[i]+":"+e[s[i]]+";";return t}function getNormalizedComponentScale(e){switch(e){case Int8Array:return 1/127;case Uint8Array:return 1/255;case Int16Array:return 1/32767;case Uint16Array:return 1/65535;default:throw Error("THREE.GLTFLoader: Unsupported normalized accessor component type.")}}let T=new i.yGw;let GLTFParser=class GLTFParser{constructor(e={},t={}){this.json=e,this.extensions={},this.plugins={},this.options=t,this.cache=new GLTFRegistry,this.associations=new Map,this.primitiveCache={},this.nodeCache={},this.meshCache={refs:{},uses:{}},this.cameraCache={refs:{},uses:{}},this.lightCache={refs:{},uses:{}},this.sourceCache={},this.textureCache={},this.nodeNamesUsed={};let s=!1,n=-1,r=!1,a=-1;if("undefined"!=typeof navigator){let e=navigator.userAgent;s=!0===/^((?!chrome|android).)*safari/i.test(e);let t=e.match(/Version\/(\d+)/);n=s&&t?parseInt(t[1],10):-1,a=(r=e.indexOf("Firefox")>-1)?e.match(/Firefox\/([0-9]+)\./)[1]:-1}"undefined"==typeof createImageBitmap||s&&n<17||r&&a<98?this.textureLoader=new i.dpR(this.options.manager):this.textureLoader=new i.QRU(this.options.manager),this.textureLoader.setCrossOrigin(this.options.crossOrigin),this.textureLoader.setRequestHeader(this.options.requestHeader),this.fileLoader=new i.hH6(this.options.manager),this.fileLoader.setResponseType("arraybuffer"),"use-credentials"===this.options.crossOrigin&&this.fileLoader.setWithCredentials(!0)}setExtensions(e){this.extensions=e}setPlugins(e){this.plugins=e}parse(e,t){let s=this,i=this.json,n=this.extensions;this.cache.removeAll(),this.nodeCache={},this._invokeAll(function(e){return e._markDefs&&e._markDefs()}),Promise.all(this._invokeAll(function(e){return e.beforeRoot&&e.beforeRoot()})).then(function(){return Promise.all([s.getDependencies("scene"),s.getDependencies("animation"),s.getDependencies("camera")])}).then(function(t){let r={scene:t[0][i.scene||0],scenes:t[0],animations:t[1],cameras:t[2],asset:i.asset,parser:s,userData:{}};return addUnknownExtensionsToUserData(n,r,i),assignExtrasToUserData(r,i),Promise.all(s._invokeAll(function(e){return e.afterRoot&&e.afterRoot(r)})).then(function(){for(let e of r.scenes)e.updateMatrixWorld();e(r)})}).catch(t)}_markDefs(){let e=this.json.nodes||[],t=this.json.skins||[],s=this.json.meshes||[];for(let s=0,i=t.length;s<i;s++){let i=t[s].joints;for(let t=0,s=i.length;t<s;t++)e[i[t]].isBone=!0}for(let t=0,i=e.length;t<i;t++){let i=e[t];void 0!==i.mesh&&(this._addNodeRef(this.meshCache,i.mesh),void 0!==i.skin&&(s[i.mesh].isSkinnedMesh=!0)),void 0!==i.camera&&this._addNodeRef(this.cameraCache,i.camera)}}_addNodeRef(e,t){void 0!==t&&(void 0===e.refs[t]&&(e.refs[t]=e.uses[t]=0),e.refs[t]++)}_getNodeRef(e,t,s){if(e.refs[t]<=1)return s;let i=s.clone(),updateMappings=(e,t)=>{let s=this.associations.get(e);for(let[i,n]of(null!=s&&this.associations.set(t,s),e.children.entries()))updateMappings(n,t.children[i])};return updateMappings(s,i),i.name+="_instance_"+e.uses[t]++,i}_invokeOne(e){let t=Object.values(this.plugins);t.push(this);for(let s=0;s<t.length;s++){let i=e(t[s]);if(i)return i}return null}_invokeAll(e){let t=Object.values(this.plugins);t.unshift(this);let s=[];for(let i=0;i<t.length;i++){let n=e(t[i]);n&&s.push(n)}return s}getDependency(e,t){let s=e+":"+t,i=this.cache.get(s);if(!i){switch(e){case"scene":i=this.loadScene(t);break;case"node":i=this._invokeOne(function(e){return e.loadNode&&e.loadNode(t)});break;case"mesh":i=this._invokeOne(function(e){return e.loadMesh&&e.loadMesh(t)});break;case"accessor":i=this.loadAccessor(t);break;case"bufferView":i=this._invokeOne(function(e){return e.loadBufferView&&e.loadBufferView(t)});break;case"buffer":i=this.loadBuffer(t);break;case"material":i=this._invokeOne(function(e){return e.loadMaterial&&e.loadMaterial(t)});break;case"texture":i=this._invokeOne(function(e){return e.loadTexture&&e.loadTexture(t)});break;case"skin":i=this.loadSkin(t);break;case"animation":i=this._invokeOne(function(e){return e.loadAnimation&&e.loadAnimation(t)});break;case"camera":i=this.loadCamera(t);break;default:if(!(i=this._invokeOne(function(s){return s!=this&&s.getDependency&&s.getDependency(e,t)})))throw Error("Unknown type: "+e)}this.cache.add(s,i)}return i}getDependencies(e){let t=this.cache.get(e);if(!t){let s=this,i=this.json[e+("mesh"===e?"es":"s")]||[];t=Promise.all(i.map(function(t,i){return s.getDependency(e,i)})),this.cache.add(e,t)}return t}loadBuffer(e){let t=this.json.buffers[e],s=this.fileLoader;if(t.type&&"arraybuffer"!==t.type)throw Error("THREE.GLTFLoader: "+t.type+" buffer type is not supported.");if(void 0===t.uri&&0===e)return Promise.resolve(this.extensions[n.KHR_BINARY_GLTF].body);let r=this.options;return new Promise(function(e,n){s.load(i.Zp0.resolveURL(t.uri,r.path),e,void 0,function(){n(Error('THREE.GLTFLoader: Failed to load buffer "'+t.uri+'".'))})})}loadBufferView(e){let t=this.json.bufferViews[e];return this.getDependency("buffer",t.buffer).then(function(e){let s=t.byteLength||0,i=t.byteOffset||0;return e.slice(i,i+s)})}loadAccessor(e){let t=this,s=this.json,n=this.json.accessors[e];if(void 0===n.bufferView&&void 0===n.sparse){let e=p[n.type],t=h[n.componentType],s=!0===n.normalized,r=new t(n.count*e);return Promise.resolve(new i.TlE(r,e,s))}let r=[];return void 0!==n.bufferView?r.push(this.getDependency("bufferView",n.bufferView)):r.push(null),void 0!==n.sparse&&(r.push(this.getDependency("bufferView",n.sparse.indices.bufferView)),r.push(this.getDependency("bufferView",n.sparse.values.bufferView))),Promise.all(r).then(function(e){let r,a;let o=e[0],l=p[n.type],c=h[n.componentType],u=c.BYTES_PER_ELEMENT,d=u*l,m=n.byteOffset||0,f=void 0!==n.bufferView?s.bufferViews[n.bufferView].byteStride:void 0,g=!0===n.normalized;if(f&&f!==d){let e=Math.floor(m/f),s="InterleavedBuffer:"+n.bufferView+":"+n.componentType+":"+e+":"+n.count,h=t.cache.get(s);h||(r=new c(o,e*f,n.count*f/u),h=new i.vpT(r,f/u),t.cache.add(s,h)),a=new i.kB5(h,l,m%f/u,g)}else r=null===o?new c(n.count*l):new c(o,m,n.count*l),a=new i.TlE(r,l,g);if(void 0!==n.sparse){let t=p.SCALAR,s=h[n.sparse.indices.componentType],r=n.sparse.indices.byteOffset||0,u=n.sparse.values.byteOffset||0,d=new s(e[1],r,n.sparse.count*t),m=new c(e[2],u,n.sparse.count*l);null!==o&&(a=new i.TlE(a.array.slice(),a.itemSize,a.normalized)),a.normalized=!1;for(let e=0,t=d.length;e<t;e++){let t=d[e];if(a.setX(t,m[e*l]),l>=2&&a.setY(t,m[e*l+1]),l>=3&&a.setZ(t,m[e*l+2]),l>=4&&a.setW(t,m[e*l+3]),l>=5)throw Error("THREE.GLTFLoader: Unsupported itemSize in sparse BufferAttribute.")}a.normalized=g}return a})}loadTexture(e){let t=this.json,s=this.options,i=t.textures[e],n=i.source,r=t.images[n],a=this.textureLoader;if(r.uri){let e=s.manager.getHandler(r.uri);null!==e&&(a=e)}return this.loadTextureImage(e,n,a)}loadTextureImage(e,t,s){let n=this,r=this.json,a=r.textures[e],o=r.images[t],l=(o.uri||o.bufferView)+":"+a.sampler;if(this.textureCache[l])return this.textureCache[l];let h=this.loadImageSource(t,s).then(function(t){t.flipY=!1,t.name=a.name||o.name||"",""===t.name&&"string"==typeof o.uri&&!1===o.uri.startsWith("data:image/")&&(t.name=o.uri);let s=r.samplers||{},l=s[a.sampler]||{};return t.magFilter=c[l.magFilter]||i.wem,t.minFilter=c[l.minFilter]||i.D1R,t.wrapS=u[l.wrapS]||i.rpg,t.wrapT=u[l.wrapT]||i.rpg,t.generateMipmaps=!t.isCompressedTexture&&t.minFilter!==i.TyD&&t.minFilter!==i.wem,n.associations.set(t,{textures:e}),t}).catch(function(){return null});return this.textureCache[l]=h,h}loadImageSource(e,t){let s=this.json,n=this.options;if(void 0!==this.sourceCache[e])return this.sourceCache[e].then(e=>e.clone());let r=s.images[e],a=self.URL||self.webkitURL,o=r.uri||"",l=!1;if(void 0!==r.bufferView)o=this.getDependency("bufferView",r.bufferView).then(function(e){l=!0;let t=new Blob([e],{type:r.mimeType});return o=a.createObjectURL(t)});else if(void 0===r.uri)throw Error("THREE.GLTFLoader: Image "+e+" is missing URI and bufferView");let h=Promise.resolve(o).then(function(e){return new Promise(function(s,r){let a=s;!0===t.isImageBitmapLoader&&(a=function(e){let t=new i.xEZ(e);t.needsUpdate=!0,s(t)}),t.load(i.Zp0.resolveURL(e,n.path),a,void 0,r)})}).then(function(e){var t;return!0===l&&a.revokeObjectURL(o),assignExtrasToUserData(e,r),e.userData.mimeType=r.mimeType||((t=r.uri).search(/\.jpe?g($|\?)/i)>0||0===t.search(/^data\:image\/jpeg/)?"image/jpeg":t.search(/\.webp($|\?)/i)>0||0===t.search(/^data\:image\/webp/)?"image/webp":t.search(/\.ktx2($|\?)/i)>0||0===t.search(/^data\:image\/ktx2/)?"image/ktx2":"image/png"),e}).catch(function(e){throw console.error("THREE.GLTFLoader: Couldn't load texture",o),e});return this.sourceCache[e]=h,h}assignTexture(e,t,s,i){let r=this;return this.getDependency("texture",s.index).then(function(a){if(!a)return null;if(void 0!==s.texCoord&&s.texCoord>0&&((a=a.clone()).channel=s.texCoord),r.extensions[n.KHR_TEXTURE_TRANSFORM]){let e=void 0!==s.extensions?s.extensions[n.KHR_TEXTURE_TRANSFORM]:void 0;if(e){let t=r.associations.get(a);a=r.extensions[n.KHR_TEXTURE_TRANSFORM].extendTexture(a,e),r.associations.set(a,t)}}return void 0!==i&&(a.colorSpace=i),e[t]=a,a})}assignFinalMaterial(e){let t=e.geometry,s=e.material,n=void 0===t.attributes.tangent,r=void 0!==t.attributes.color,a=void 0===t.attributes.normal;if(e.isPoints){let e="PointsMaterial:"+s.uuid,t=this.cache.get(e);t||(t=new i.UY4,i.F5T.prototype.copy.call(t,s),t.color.copy(s.color),t.map=s.map,t.sizeAttenuation=!1,this.cache.add(e,t)),s=t}else if(e.isLine){let e="LineBasicMaterial:"+s.uuid,t=this.cache.get(e);t||(t=new i.nls,i.F5T.prototype.copy.call(t,s),t.color.copy(s.color),t.map=s.map,this.cache.add(e,t)),s=t}if(n||r||a){let e="ClonedMaterial:"+s.uuid+":";n&&(e+="derivative-tangents:"),r&&(e+="vertex-colors:"),a&&(e+="flat-shading:");let t=this.cache.get(e);t||(t=s.clone(),r&&(t.vertexColors=!0),a&&(t.flatShading=!0),n&&(t.normalScale&&(t.normalScale.y*=-1),t.clearcoatNormalScale&&(t.clearcoatNormalScale.y*=-1)),this.cache.add(e,t),this.associations.set(t,this.associations.get(s))),s=t}e.material=s}getMaterialType(){return i.Wid}loadMaterial(e){let t;let s=this,r=this.json,a=this.extensions,o=r.materials[e],l={},h=o.extensions||{},c=[];if(h[n.KHR_MATERIALS_UNLIT]){let e=a[n.KHR_MATERIALS_UNLIT];t=e.getMaterialType(),c.push(e.extendParams(l,o,s))}else{let n=o.pbrMetallicRoughness||{};if(l.color=new i.Ilk(1,1,1),l.opacity=1,Array.isArray(n.baseColorFactor)){let e=n.baseColorFactor;l.color.setRGB(e[0],e[1],e[2],i.GUF),l.opacity=e[3]}void 0!==n.baseColorTexture&&c.push(s.assignTexture(l,"map",n.baseColorTexture,i.KI_)),l.metalness=void 0!==n.metallicFactor?n.metallicFactor:1,l.roughness=void 0!==n.roughnessFactor?n.roughnessFactor:1,void 0!==n.metallicRoughnessTexture&&(c.push(s.assignTexture(l,"metalnessMap",n.metallicRoughnessTexture)),c.push(s.assignTexture(l,"roughnessMap",n.metallicRoughnessTexture))),t=this._invokeOne(function(t){return t.getMaterialType&&t.getMaterialType(e)}),c.push(Promise.all(this._invokeAll(function(t){return t.extendMaterialParams&&t.extendMaterialParams(e,l)})))}!0===o.doubleSided&&(l.side=i.ehD);let u=o.alphaMode||g.OPAQUE;if(u===g.BLEND?(l.transparent=!0,l.depthWrite=!1):(l.transparent=!1,u===g.MASK&&(l.alphaTest=void 0!==o.alphaCutoff?o.alphaCutoff:.5)),void 0!==o.normalTexture&&t!==i.vBJ&&(c.push(s.assignTexture(l,"normalMap",o.normalTexture)),l.normalScale=new i.FM8(1,1),void 0!==o.normalTexture.scale)){let e=o.normalTexture.scale;l.normalScale.set(e,e)}if(void 0!==o.occlusionTexture&&t!==i.vBJ&&(c.push(s.assignTexture(l,"aoMap",o.occlusionTexture)),void 0!==o.occlusionTexture.strength&&(l.aoMapIntensity=o.occlusionTexture.strength)),void 0!==o.emissiveFactor&&t!==i.vBJ){let e=o.emissiveFactor;l.emissive=new i.Ilk().setRGB(e[0],e[1],e[2],i.GUF)}return void 0!==o.emissiveTexture&&t!==i.vBJ&&c.push(s.assignTexture(l,"emissiveMap",o.emissiveTexture,i.KI_)),Promise.all(c).then(function(){let i=new t(l);return o.name&&(i.name=o.name),assignExtrasToUserData(i,o),s.associations.set(i,{materials:e}),o.extensions&&addUnknownExtensionsToUserData(a,i,o),i})}createUniqueName(e){let t=i.iUV.sanitizeNodeName(e||"");return t in this.nodeNamesUsed?t+"_"+ ++this.nodeNamesUsed[t]:(this.nodeNamesUsed[t]=0,t)}loadGeometries(e){let t=this,s=this.extensions,r=this.primitiveCache,a=[];for(let o=0,l=e.length;o<l;o++){let l=e[o],h=function(e){let t;let s=e.extensions&&e.extensions[n.KHR_DRACO_MESH_COMPRESSION];if(t=s?"draco:"+s.bufferView+":"+s.indices+":"+createAttributesKey(s.attributes):e.indices+":"+createAttributesKey(e.attributes)+":"+e.mode,void 0!==e.targets)for(let s=0,i=e.targets.length;s<i;s++)t+=":"+createAttributesKey(e.targets[s]);return t}(l),c=r[h];if(c)a.push(c.promise);else{let e;e=l.extensions&&l.extensions[n.KHR_DRACO_MESH_COMPRESSION]?function(e){return s[n.KHR_DRACO_MESH_COMPRESSION].decodePrimitive(e,t).then(function(s){return addPrimitiveAttributes(s,e,t)})}(l):addPrimitiveAttributes(new i.u9r,l,t),r[h]={primitive:l,promise:e},a.push(e)}}return Promise.all(a)}loadMesh(e){let t=this,s=this.json,n=this.extensions,r=s.meshes[e],a=r.primitives,o=[];for(let e=0,t=a.length;e<t;e++){var h;let t=void 0===a[e].material?(void 0===(h=this.cache).DefaultMaterial&&(h.DefaultMaterial=new i.Wid({color:16777215,emissive:0,metalness:1,roughness:1,transparent:!1,depthTest:!0,side:i.Wl3})),h.DefaultMaterial):this.getDependency("material",a[e].material);o.push(t)}return o.push(t.loadGeometries(a)),Promise.all(o).then(function(s){let o=s.slice(0,s.length-1),h=s[s.length-1],c=[];for(let s=0,u=h.length;s<u;s++){let u;let p=h[s],d=a[s],m=o[s];if(d.mode===l.TRIANGLES||d.mode===l.TRIANGLE_STRIP||d.mode===l.TRIANGLE_FAN||void 0===d.mode)!0===(u=!0===r.isSkinnedMesh?new i.TUv(p,m):new i.Kj0(p,m)).isSkinnedMesh&&u.normalizeSkinWeights(),d.mode===l.TRIANGLE_STRIP?u.geometry=toTrianglesDrawMode(u.geometry,i.UlW):d.mode===l.TRIANGLE_FAN&&(u.geometry=toTrianglesDrawMode(u.geometry,i.z$h));else if(d.mode===l.LINES)u=new i.ejS(p,m);else if(d.mode===l.LINE_STRIP)u=new i.x12(p,m);else if(d.mode===l.LINE_LOOP)u=new i.blk(p,m);else if(d.mode===l.POINTS)u=new i.woe(p,m);else throw Error("THREE.GLTFLoader: Primitive mode unsupported: "+d.mode);Object.keys(u.geometry.morphAttributes).length>0&&function(e,t){if(e.updateMorphTargets(),void 0!==t.weights)for(let s=0,i=t.weights.length;s<i;s++)e.morphTargetInfluences[s]=t.weights[s];if(t.extras&&Array.isArray(t.extras.targetNames)){let s=t.extras.targetNames;if(e.morphTargetInfluences.length===s.length){e.morphTargetDictionary={};for(let t=0,i=s.length;t<i;t++)e.morphTargetDictionary[s[t]]=t}else console.warn("THREE.GLTFLoader: Invalid extras.targetNames length. Ignoring names.")}}(u,r),u.name=t.createUniqueName(r.name||"mesh_"+e),assignExtrasToUserData(u,r),d.extensions&&addUnknownExtensionsToUserData(n,u,d),t.assignFinalMaterial(u),c.push(u)}for(let s=0,i=c.length;s<i;s++)t.associations.set(c[s],{meshes:e,primitives:s});if(1===c.length)return r.extensions&&addUnknownExtensionsToUserData(n,c[0],r),c[0];let u=new i.ZAu;r.extensions&&addUnknownExtensionsToUserData(n,u,r),t.associations.set(u,{meshes:e});for(let e=0,t=c.length;e<t;e++)u.add(c[e]);return u})}loadCamera(e){let t;let s=this.json.cameras[e],n=s[s.type];if(!n){console.warn("THREE.GLTFLoader: Missing camera parameters.");return}return"perspective"===s.type?t=new i.cPb(i.M8C.radToDeg(n.yfov),n.aspectRatio||1,n.znear||1,n.zfar||2e6):"orthographic"===s.type&&(t=new i.iKG(-n.xmag,n.xmag,n.ymag,-n.ymag,n.znear,n.zfar)),s.name&&(t.name=this.createUniqueName(s.name)),assignExtrasToUserData(t,s),Promise.resolve(t)}loadSkin(e){let t=this.json.skins[e],s=[];for(let e=0,i=t.joints.length;e<i;e++)s.push(this._loadNodeShallow(t.joints[e]));return void 0!==t.inverseBindMatrices?s.push(this.getDependency("accessor",t.inverseBindMatrices)):s.push(null),Promise.all(s).then(function(e){let s=e.pop(),n=[],r=[];for(let a=0,o=e.length;a<o;a++){let o=e[a];if(o){n.push(o);let e=new i.yGw;null!==s&&e.fromArray(s.array,16*a),r.push(e)}else console.warn('THREE.GLTFLoader: Joint "%s" could not be found.',t.joints[a])}return new i.OdW(n,r)})}loadAnimation(e){let t=this.json,s=this,n=t.animations[e],r=n.name?n.name:"animation_"+e,a=[],o=[],l=[],h=[],c=[];for(let e=0,t=n.channels.length;e<t;e++){let t=n.channels[e],s=n.samplers[t.sampler],i=t.target,r=i.node,u=void 0!==n.parameters?n.parameters[s.input]:s.input,p=void 0!==n.parameters?n.parameters[s.output]:s.output;void 0!==i.node&&(a.push(this.getDependency("node",r)),o.push(this.getDependency("accessor",u)),l.push(this.getDependency("accessor",p)),h.push(s),c.push(i))}return Promise.all([Promise.all(a),Promise.all(o),Promise.all(l),Promise.all(h),Promise.all(c)]).then(function(e){let t=e[0],n=e[1],a=e[2],o=e[3],l=e[4],h=[];for(let e=0,i=t.length;e<i;e++){let i=t[e],r=n[e],c=a[e],u=o[e],p=l[e];if(void 0===i)continue;i.updateMatrix&&i.updateMatrix();let d=s._createAnimationTracks(i,r,c,u,p);if(d)for(let e=0;e<d.length;e++)h.push(d[e])}return new i.m7l(r,void 0,h)})}createNodeMesh(e){let t=this.json,s=this,i=t.nodes[e];return void 0===i.mesh?null:s.getDependency("mesh",i.mesh).then(function(e){let t=s._getNodeRef(s.meshCache,i.mesh,e);return void 0!==i.weights&&t.traverse(function(e){if(e.isMesh)for(let t=0,s=i.weights.length;t<s;t++)e.morphTargetInfluences[t]=i.weights[t]}),t})}loadNode(e){let t=this.json,s=t.nodes[e],i=this._loadNodeShallow(e),n=[],r=s.children||[];for(let e=0,t=r.length;e<t;e++)n.push(this.getDependency("node",r[e]));let a=void 0===s.skin?Promise.resolve(null):this.getDependency("skin",s.skin);return Promise.all([i,Promise.all(n),a]).then(function(e){let t=e[0],s=e[1],i=e[2];null!==i&&t.traverse(function(e){e.isSkinnedMesh&&e.bind(i,T)});for(let e=0,i=s.length;e<i;e++)t.add(s[e]);return t})}_loadNodeShallow(e){let t=this.json,s=this.extensions,n=this;if(void 0!==this.nodeCache[e])return this.nodeCache[e];let r=t.nodes[e],a=r.name?n.createUniqueName(r.name):"",o=[],l=n._invokeOne(function(t){return t.createNodeMesh&&t.createNodeMesh(e)});return l&&o.push(l),void 0!==r.camera&&o.push(n.getDependency("camera",r.camera).then(function(e){return n._getNodeRef(n.cameraCache,r.camera,e)})),n._invokeAll(function(t){return t.createNodeAttachment&&t.createNodeAttachment(e)}).forEach(function(e){o.push(e)}),this.nodeCache[e]=Promise.all(o).then(function(t){let o;if((o=!0===r.isBone?new i.N$j:t.length>1?new i.ZAu:1===t.length?t[0]:new i.Tme)!==t[0])for(let e=0,s=t.length;e<s;e++)o.add(t[e]);if(r.name&&(o.userData.name=r.name,o.name=a),assignExtrasToUserData(o,r),r.extensions&&addUnknownExtensionsToUserData(s,o,r),void 0!==r.matrix){let e=new i.yGw;e.fromArray(r.matrix),o.applyMatrix4(e)}else void 0!==r.translation&&o.position.fromArray(r.translation),void 0!==r.rotation&&o.quaternion.fromArray(r.rotation),void 0!==r.scale&&o.scale.fromArray(r.scale);return n.associations.has(o)||n.associations.set(o,{}),n.associations.get(o).nodes=e,o}),this.nodeCache[e]}loadScene(e){let t=this.extensions,s=this.json.scenes[e],n=this,r=new i.ZAu;s.name&&(r.name=n.createUniqueName(s.name)),assignExtrasToUserData(r,s),s.extensions&&addUnknownExtensionsToUserData(t,r,s);let a=s.nodes||[],o=[];for(let e=0,t=a.length;e<t;e++)o.push(n.getDependency("node",a[e]));return Promise.all(o).then(function(e){for(let t=0,s=e.length;t<s;t++)r.add(e[t]);return n.associations=(e=>{let t=new Map;for(let[e,s]of n.associations)(e instanceof i.F5T||e instanceof i.xEZ)&&t.set(e,s);return e.traverse(e=>{let s=n.associations.get(e);null!=s&&t.set(e,s)}),t})(r),r})}_createAnimationTracks(e,t,s,n,r){let a;let o=[],l=e.name?e.name:e.uuid,h=[];switch(m[r.path]===m.weights?e.traverse(function(e){e.morphTargetInfluences&&h.push(e.name?e.name:e.uuid)}):h.push(l),m[r.path]){case m.weights:a=i.dUE;break;case m.rotation:a=i.iLg;break;case m.position:case m.scale:a=i.yC1;break;default:a=1===s.itemSize?i.dUE:i.yC1}let c=void 0!==n.interpolation?f[n.interpolation]:i.NMF,u=this._getArrayFromAccessor(s);for(let e=0,s=h.length;e<s;e++){let s=new a(h[e]+"."+m[r.path],t.array,u,c);"CUBICSPLINE"===n.interpolation&&this._createCubicSplineTrackInterpolant(s),o.push(s)}return o}_getArrayFromAccessor(e){let t=e.array;if(e.normalized){let e=getNormalizedComponentScale(t.constructor),s=new Float32Array(t.length);for(let i=0,n=t.length;i<n;i++)s[i]=t[i]*e;t=s}return t}_createCubicSplineTrackInterpolant(e){e.createInterpolant=function(e){let t=this instanceof i.iLg?GLTFCubicSplineQuaternionInterpolant:GLTFCubicSplineInterpolant;return new t(this.times,this.values,this.getValueSize()/3,e)},e.createInterpolant.isInterpolantFactoryMethodGLTFCubicSpline=!0}};function addPrimitiveAttributes(e,t,s){let n=t.attributes,r=[];for(let t in n){let i=d[t]||t.toLowerCase();i in e.attributes||r.push(function(t,i){return s.getDependency("accessor",t).then(function(t){e.setAttribute(i,t)})}(n[t],i))}if(void 0!==t.indices&&!e.index){let i=s.getDependency("accessor",t.indices).then(function(t){e.setIndex(t)});r.push(i)}return i.epp.workingColorSpace!==i.GUF&&"COLOR_0"in n&&console.warn(`THREE.GLTFLoader: Converting vertex colors from "srgb-linear" to "${i.epp.workingColorSpace}" not supported.`),assignExtrasToUserData(e,t),!function(e,t,s){let n=t.attributes,r=new i.ZzF;if(void 0===n.POSITION)return;{let e=s.json.accessors[n.POSITION],t=e.min,a=e.max;if(void 0!==t&&void 0!==a){if(r.set(new i.Pa4(t[0],t[1],t[2]),new i.Pa4(a[0],a[1],a[2])),e.normalized){let t=getNormalizedComponentScale(h[e.componentType]);r.min.multiplyScalar(t),r.max.multiplyScalar(t)}}else{console.warn("THREE.GLTFLoader: Missing min/max properties for accessor POSITION.");return}}let a=t.targets;if(void 0!==a){let e=new i.Pa4,t=new i.Pa4;for(let i=0,n=a.length;i<n;i++){let n=a[i];if(void 0!==n.POSITION){let i=s.json.accessors[n.POSITION],r=i.min,a=i.max;if(void 0!==r&&void 0!==a){if(t.setX(Math.max(Math.abs(r[0]),Math.abs(a[0]))),t.setY(Math.max(Math.abs(r[1]),Math.abs(a[1]))),t.setZ(Math.max(Math.abs(r[2]),Math.abs(a[2]))),i.normalized){let e=getNormalizedComponentScale(h[i.componentType]);t.multiplyScalar(e)}e.max(t)}else console.warn("THREE.GLTFLoader: Missing min/max properties for accessor POSITION.")}}r.expandByVector(e)}e.boundingBox=r;let o=new i.aLr;r.getCenter(o.center),o.radius=r.min.distanceTo(r.max)/2,e.boundingSphere=o}(e,t,s),Promise.all(r).then(function(){return void 0!==t.targets?function(e,t,s){let i=!1,n=!1,r=!1;for(let e=0,s=t.length;e<s;e++){let s=t[e];if(void 0!==s.POSITION&&(i=!0),void 0!==s.NORMAL&&(n=!0),void 0!==s.COLOR_0&&(r=!0),i&&n&&r)break}if(!i&&!n&&!r)return Promise.resolve(e);let a=[],o=[],l=[];for(let h=0,c=t.length;h<c;h++){let c=t[h];if(i){let t=void 0!==c.POSITION?s.getDependency("accessor",c.POSITION):e.attributes.position;a.push(t)}if(n){let t=void 0!==c.NORMAL?s.getDependency("accessor",c.NORMAL):e.attributes.normal;o.push(t)}if(r){let t=void 0!==c.COLOR_0?s.getDependency("accessor",c.COLOR_0):e.attributes.color;l.push(t)}}return Promise.all([Promise.all(a),Promise.all(o),Promise.all(l)]).then(function(t){let s=t[0],a=t[1],o=t[2];return i&&(e.morphAttributes.position=s),n&&(e.morphAttributes.normal=a),r&&(e.morphAttributes.color=o),e.morphTargetsRelative=!0,e})}(e,t.targets,s):e})}}}]);